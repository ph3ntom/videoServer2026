# StreamFlix - ë¹„ë””ì˜¤ ìŠ¤íŠ¸ë¦¬ë° í”Œë«í¼

## ğŸ“š ê°œë°œ í”„ë¡œì„¸ìŠ¤ ë¬¸ì„œ

ì´ ë””ë ‰í† ë¦¬ëŠ” StreamFlix í”„ë¡œì íŠ¸ì˜ ê°œë°œ ê³¼ì •, API ëª…ì„¸, ì•„í‚¤í…ì²˜ ì„¤ê³„ë¥¼ ë¬¸ì„œí™”í•©ë‹ˆë‹¤.

---

## ğŸ“‹ ë¬¸ì„œ ëª©ë¡

### ê¸°ëŠ¥ë³„ ëª…ì„¸ì„œ

1. **[v0.1 - ì¸ì¦ ì‹œìŠ¤í…œ](./1.v0.1-authentication.md)**
   - ì‚¬ìš©ì íšŒì›ê°€ì…, ë¡œê·¸ì¸, ì´ë©”ì¼ ì¸ì¦
   - JWT í† í° ê¸°ë°˜ ì¸ì¦
   - ë¹„ë°€ë²ˆí˜¸ í•´ì‹± ë° ë³´ì•ˆ

2. **[v0.2 - ë¹„ë””ì˜¤ ì—…ë¡œë“œ ë° ìŠ¤íŠ¸ë¦¬ë°](./2.v0.2-video-upload-streaming.md)**
   - ë¹„ë””ì˜¤ íŒŒì¼ ì—…ë¡œë“œ (ìµœëŒ€ 5GB)
   - FFmpeg ë©”íƒ€ë°ì´í„° ìë™ ì¶”ì¶œ
   - HTTP ìŠ¤íŠ¸ë¦¬ë° ì¬ìƒ

3. **[v0.3 - ì¸ë„¤ì¼ ìë™ ìƒì„± ì‹œìŠ¤í…œ](./3.v0.3-thumbnail-system.md)**
   - ì¥ë©´ ê°ì§€ ê¸°ë°˜ ì¸ë„¤ì¼ ì¶”ì¶œ
   - 4K ë¹„ë””ì˜¤ ëŒ€ì‘ (ê°„ê²© ê¸°ë°˜)
   - ì»¤ìŠ¤í…€ ì¸ë„¤ì¼ ì—…ë¡œë“œ

4. **[v0.4 - ì¸ë„¤ì¼ í˜¸ë²„ í”„ë¦¬ë·°](./4.v0.4-thumbnail-hover-preview.md)**
   - YouTube ìŠ¤íƒ€ì¼ ì¸ë„¤ì¼ ì• ë‹ˆë©”ì´ì…˜
   - Intersection Observer ì„±ëŠ¥ ìµœì í™”
   - 300ms ë””ë°”ìš´ìŠ¤

---

## ğŸ—ï¸ ì „ì²´ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```mermaid
graph TB
    subgraph "Frontend (React + TypeScript)"
        A[Register/Login Pages]
        B[Video Upload]
        C[Video List]
        D[Video Player]
        E[Auth Context]
        F[API Client]
    end

    subgraph "Backend (FastAPI + Python)"
        G[Auth Router]
        H[Video Router]
        I[Auth Service]
        J[Video Service]
        K[Thumbnail Service]
        L[Email Service]
    end

    subgraph "External Services"
        M[FFmpeg/FFprobe]
        N[SMTP Server]
    end

    subgraph "Database (PostgreSQL)"
        O[(users)]
        P[(email_verifications)]
        Q[(videos)]
        R[(video_thumbnails)]
    end

    subgraph "Storage"
        S[Video Files<br/>/tmp/videos/]
        T[Thumbnails<br/>/tmp/videos/thumbnails/]
    end

    A --> E
    B --> E
    C --> E
    D --> E
    E --> F
    F --> G
    F --> H

    G --> I
    H --> J
    J --> K
    I --> L

    I --> O
    I --> P
    J --> Q
    K --> R
    J --> M
    K --> M
    L --> N

    J --> S
    K --> T
```

---

## ğŸ—„ï¸ ì „ì²´ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

```mermaid
erDiagram
    users {
        int id PK
        string email UK
        string username UK
        string hashed_password
        boolean is_active
        boolean is_verified
        datetime created_at
        datetime updated_at
    }

    email_verifications {
        int id PK
        int user_id FK
        string code
        datetime expires_at
        boolean is_used
        datetime created_at
    }

    videos {
        int id PK
        int user_id FK
        string title
        text description
        string file_path
        bigint file_size
        string thumbnail_path
        int duration
        int width
        int height
        enum status
        int view_count
        datetime created_at
        datetime updated_at
    }

    video_thumbnails {
        int id PK
        int video_id FK
        string file_path
        boolean is_auto_generated
        boolean is_selected
        datetime created_at
    }

    tags {
        int id PK
        string name UK
        string slug UK
        text description
        string color
        datetime created_at
        datetime updated_at
    }

    video_tags {
        int video_id FK
        int tag_id FK
    }

    users ||--o{ email_verifications : "has"
    users ||--o{ videos : "uploads"
    videos ||--o{ video_thumbnails : "has"
    videos ||--o{ video_tags : "has"
    tags ||--o{ video_tags : "has"
```

---

## ğŸ”Œ API ì—”ë“œí¬ì¸íŠ¸ ìš”ì•½

### ì¸ì¦ (Authentication)
| Method | Endpoint | ì¸ì¦ | ì„¤ëª… |
|--------|----------|------|------|
| POST | `/api/v1/auth/register` | âŒ | íšŒì›ê°€ì… |
| POST | `/api/v1/auth/send-verification` | âŒ | ì¸ì¦ ì½”ë“œ ì „ì†¡ |
| POST | `/api/v1/auth/verify-email` | âŒ | ì´ë©”ì¼ ì¸ì¦ |
| POST | `/api/v1/auth/login` | âŒ | ë¡œê·¸ì¸ |
| POST | `/api/v1/auth/refresh` | âŒ | í† í° ê°±ì‹  |
| GET | `/api/v1/auth/me` | âœ… | ì‚¬ìš©ì ì •ë³´ |

### ë¹„ë””ì˜¤ (Videos)
| Method | Endpoint | ì¸ì¦ | ì„¤ëª… |
|--------|----------|------|------|
| POST | `/api/v1/videos/upload` | âœ… | ë¹„ë””ì˜¤ ì—…ë¡œë“œ |
| GET | `/api/v1/videos/` | âŒ | ë¹„ë””ì˜¤ ëª©ë¡ |
| GET | `/api/v1/videos/{id}` | âŒ | ë¹„ë””ì˜¤ ìƒì„¸ |
| GET | `/api/v1/videos/{id}/stream` | âŒ | ë¹„ë””ì˜¤ ìŠ¤íŠ¸ë¦¬ë° |
| GET | `/api/v1/videos/my-videos` | âœ… | ë‚´ ë¹„ë””ì˜¤ |
| PUT | `/api/v1/videos/{id}` | âœ… | ë¹„ë””ì˜¤ ìˆ˜ì • |
| DELETE | `/api/v1/videos/{id}` | âœ… | ë¹„ë””ì˜¤ ì‚­ì œ |

### ì¸ë„¤ì¼ (Thumbnails)
| Method | Endpoint | ì¸ì¦ | ì„¤ëª… |
|--------|----------|------|------|
| GET | `/api/v1/videos/{id}/thumbnails` | âŒ | ì¸ë„¤ì¼ ëª©ë¡ |
| GET | `/api/v1/videos/{id}/thumbnails/{tid}/image` | âŒ | ì¸ë„¤ì¼ ì´ë¯¸ì§€ |
| GET | `/api/v1/videos/{id}/thumbnail` | âŒ | ì„ íƒëœ ì¸ë„¤ì¼ |
| POST | `/api/v1/videos/{id}/thumbnails/select` | âœ… | ì¸ë„¤ì¼ ì„ íƒ |
| POST | `/api/v1/videos/{id}/thumbnails/upload` | âœ… | ì»¤ìŠ¤í…€ ì¸ë„¤ì¼ |

---

## ğŸ› ï¸ ê¸°ìˆ  ìŠ¤íƒ

### Frontend
- **Framework**: React 18 + TypeScript
- **Build Tool**: Vite
- **Styling**: TailwindCSS
- **Video Player**: Video.js
- **HTTP Client**: Axios
- **Routing**: React Router v6

### Backend
- **Framework**: FastAPI (Python 3.12)
- **ORM**: SQLAlchemy 2.0 (Async)
- **Database**: PostgreSQL 16
- **Migration**: Alembic
- **Authentication**: JWT (PyJWT)
- **Password**: bcrypt
- **Video Processing**: FFmpeg, FFprobe
- **Email**: SMTP (aiosmtplib)

### DevOps
- **Development**: Docker Compose
- **Storage**: Local Filesystem (/tmp/videos)
- **CORS**: Configured for localhost:5174

---

## ğŸ“Š í”„ë¡œì íŠ¸ êµ¬ì¡°

```
videos_web_server/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ api/v1/              # API ë¼ìš°í„°
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.py
â”‚   â”‚   â”‚   â””â”€â”€ videos.py
â”‚   â”‚   â”œâ”€â”€ models/              # SQLAlchemy ëª¨ë¸
â”‚   â”‚   â”‚   â”œâ”€â”€ user.py
â”‚   â”‚   â”‚   â”œâ”€â”€ email_verification.py
â”‚   â”‚   â”‚   â”œâ”€â”€ video.py
â”‚   â”‚   â”‚   â”œâ”€â”€ video_thumbnail.py
â”‚   â”‚   â”‚   â””â”€â”€ tag.py
â”‚   â”‚   â”œâ”€â”€ schemas/             # Pydantic ìŠ¤í‚¤ë§ˆ
â”‚   â”‚   â”œâ”€â”€ services/            # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
â”‚   â”‚   â”‚   â”œâ”€â”€ auth_service.py
â”‚   â”‚   â”‚   â”œâ”€â”€ video_service.py
â”‚   â”‚   â”‚   â”œâ”€â”€ thumbnail_service.py
â”‚   â”‚   â”‚   â””â”€â”€ email_service.py
â”‚   â”‚   â”œâ”€â”€ core/                # í•µì‹¬ ì„¤ì •
â”‚   â”‚   â”‚   â”œâ”€â”€ config.py
â”‚   â”‚   â”‚   â”œâ”€â”€ database.py
â”‚   â”‚   â”‚   â””â”€â”€ security.py
â”‚   â”‚   â””â”€â”€ main.py
â”‚   â”œâ”€â”€ alembic/                 # DB ë§ˆì´ê·¸ë ˆì´ì…˜
â”‚   â”œâ”€â”€ venv/
â”‚   â””â”€â”€ requirements.txt
â”‚
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ pages/               # í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ Register.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Login.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ VerifyEmail.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Upload.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Videos.tsx
â”‚   â”‚   â”‚   â””â”€â”€ VideoDetail.tsx
â”‚   â”‚   â”œâ”€â”€ components/          # ì¬ì‚¬ìš© ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ common/
â”‚   â”‚   â”‚   â””â”€â”€ video/
â”‚   â”‚   â”‚       â”œâ”€â”€ VideoCard.tsx
â”‚   â”‚   â”‚       â””â”€â”€ VideoPlayer.tsx
â”‚   â”‚   â”œâ”€â”€ contexts/            # React Context
â”‚   â”‚   â”‚   â””â”€â”€ AuthContext.tsx
â”‚   â”‚   â”œâ”€â”€ services/            # API í´ë¼ì´ì–¸íŠ¸
â”‚   â”‚   â”‚   â””â”€â”€ api.client.ts
â”‚   â”‚   â””â”€â”€ App.tsx
â”‚   â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ vite.config.ts
â”‚
â”œâ”€â”€ dev_Process/                 # ê°œë°œ ë¬¸ì„œ (ì´ ë””ë ‰í† ë¦¬)
â”‚   â”œâ”€â”€ 0.README.md
â”‚   â”œâ”€â”€ 1.v0.1-authentication.md
â”‚   â”œâ”€â”€ 2.v0.2-video-upload-streaming.md
â”‚   â”œâ”€â”€ 3.v0.3-thumbnail-system.md
â”‚   â””â”€â”€ 4.v0.4-thumbnail-hover-preview.md
â”‚
â””â”€â”€ /tmp/videos/                 # ë¹„ë””ì˜¤ ì €ì¥ì†Œ
    â”œâ”€â”€ *.mp4
    â””â”€â”€ thumbnails/
```

---

## ğŸš€ ë¹ ë¥¸ ì‹œì‘

### 1. Backend ì‹¤í–‰
```bash
cd backend
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt

# í™˜ê²½ë³€ìˆ˜ ì„¤ì • (.env)
DATABASE_URL=postgresql+asyncpg://user:password@localhost/dbname
SECRET_KEY=your-secret-key
SMTP_HOST=smtp.gmail.com
SMTP_USER=your-email@gmail.com
SMTP_PASSWORD=your-app-password

# DB ë§ˆì´ê·¸ë ˆì´ì…˜
alembic upgrade head

# ì„œë²„ ì‹¤í–‰
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

### 2. Frontend ì‹¤í–‰
```bash
cd frontend
npm install

# í™˜ê²½ë³€ìˆ˜ ì„¤ì • (.env)
VITE_API_BASE_URL=http://localhost:8000

# ê°œë°œ ì„œë²„ ì‹¤í–‰
npm run dev
```

### 3. ì ‘ì†
- Frontend: http://localhost:5174
- Backend API: http://localhost:8000
- API Docs: http://localhost:8000/docs

---

## ğŸ” ì£¼ìš” íŒŒì¼ ìœ„ì¹˜

### Backend

#### ì¸ì¦ ê´€ë ¨
- **ë¼ìš°í„°**: `backend/app/api/v1/auth.py`
- **ì„œë¹„ìŠ¤**: `backend/app/services/auth_service.py`
- **ëª¨ë¸**: `backend/app/models/user.py`
- **ë³´ì•ˆ**: `backend/app/core/security.py`

#### ë¹„ë””ì˜¤ ê´€ë ¨
- **ë¼ìš°í„°**: `backend/app/api/v1/videos.py`
- **ì„œë¹„ìŠ¤**: `backend/app/services/video_service.py`
- **ëª¨ë¸**: `backend/app/models/video.py`

#### ì¸ë„¤ì¼ ê´€ë ¨
- **ì„œë¹„ìŠ¤**: `backend/app/services/thumbnail_service.py` (16-209ì¤„)
- **ëª¨ë¸**: `backend/app/models/video_thumbnail.py`

### Frontend

#### ì¸ì¦ ê´€ë ¨
- **Context**: `frontend/src/contexts/AuthContext.tsx`
- **í˜ì´ì§€**: `frontend/src/pages/Register.tsx`, `Login.tsx`

#### ë¹„ë””ì˜¤ ê´€ë ¨
- **ëª©ë¡**: `frontend/src/pages/Videos.tsx`
- **ìƒì„¸**: `frontend/src/pages/VideoDetail.tsx`
- **ì¹´ë“œ**: `frontend/src/components/video/VideoCard.tsx`
- **í”Œë ˆì´ì–´**: `frontend/src/components/video/VideoPlayer.tsx`

---

## ğŸ”§ í™˜ê²½ ì„¤ì •

### Backend (.env)
```env
# Database
DATABASE_URL=postgresql+asyncpg://user:password@localhost/dbname

# Security
SECRET_KEY=your-secret-key-min-32-chars
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
REFRESH_TOKEN_EXPIRE_DAYS=7

# SMTP
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-email@gmail.com
SMTP_PASSWORD=your-app-password
SMTP_FROM=noreply@streamflix.com

# Upload
UPLOAD_DIR=/tmp/videos
MAX_UPLOAD_SIZE=5368709120
ALLOWED_VIDEO_EXTENSIONS=.mp4,.mkv,.avi,.mov,.webm

# FFmpeg
FFMPEG_PATH=ffmpeg
FFPROBE_PATH=ffprobe
```

### Frontend (.env)
```env
VITE_API_BASE_URL=http://localhost:8000
```

---

## ğŸ“ˆ ê°œë°œ ë¡œë“œë§µ

### âœ… ì™„ë£Œëœ ê¸°ëŠ¥
- [x] ì‚¬ìš©ì ì¸ì¦ ì‹œìŠ¤í…œ
- [x] ì´ë©”ì¼ ì¸ì¦
- [x] ë¹„ë””ì˜¤ ì—…ë¡œë“œ
- [x] ë¹„ë””ì˜¤ ìŠ¤íŠ¸ë¦¬ë°
- [x] ìë™ ì¸ë„¤ì¼ ìƒì„±
- [x] ì¸ë„¤ì¼ í˜¸ë²„ í”„ë¦¬ë·°

### ğŸš§ ì§„í–‰ ì¤‘
- [ ] íƒœê·¸ ì‹œìŠ¤í…œ API êµ¬í˜„
- [ ] ë¹„ë””ì˜¤ ê²€ìƒ‰ ê¸°ëŠ¥

### ğŸ“‹ ê³„íš ì¤‘
- [ ] ëŒ“ê¸€ ì‹œìŠ¤í…œ
- [ ] ì¢‹ì•„ìš”/ì‹«ì–´ìš”
- [ ] ì¬ìƒëª©ë¡
- [ ] êµ¬ë… ê¸°ëŠ¥
- [ ] ì•Œë¦¼ ì‹œìŠ¤í…œ
- [ ] HLS ìŠ¤íŠ¸ë¦¬ë°
- [ ] S3 ì €ì¥ì†Œ ì—°ë™
- [ ] CDN ì—°ë™
- [ ] ë¹„ë””ì˜¤ íŠ¸ëœìŠ¤ì½”ë”©

---

## ğŸ› ì•Œë ¤ì§„ ì´ìŠˆ

### 1. FFmpeg ë©”ëª¨ë¦¬ ë¬¸ì œ (âœ… í•´ê²°ë¨)
- **ë¬¸ì œ**: 4K ë¹„ë””ì˜¤ì—ì„œ ì¥ë©´ ê°ì§€ ì‹œ ë©”ëª¨ë¦¬ ë¶€ì¡±
- **í•´ê²°**: ê³ í•´ìƒë„ëŠ” ê°„ê²© ê¸°ë°˜ ì¶”ì¶œë¡œ ìë™ ì „í™˜

### 2. ëŒ€ìš©ëŸ‰ ì—…ë¡œë“œ íƒ€ì„ì•„ì›ƒ
- **í˜„ìƒ**: 5GB íŒŒì¼ ì—…ë¡œë“œ ì‹œ íƒ€ì„ì•„ì›ƒ
- **ì„ì‹œ í•´ê²°**: ì›¹ì„œë²„ íƒ€ì„ì•„ì›ƒ ì„¤ì • ì¡°ì • í•„ìš”

---

## ğŸ“ ë¬¸ì˜ ë° ì§€ì›

ê° ê¸°ëŠ¥ë³„ ìƒì„¸ ë¬¸ì„œë¥¼ ì°¸ì¡°í•˜ì„¸ìš”:
- ì¸ì¦ ê´€ë ¨: [1.v0.1-authentication.md](./1.v0.1-authentication.md)
- ë¹„ë””ì˜¤ ê´€ë ¨: [2.v0.2-video-upload-streaming.md](./2.v0.2-video-upload-streaming.md)
- ì¸ë„¤ì¼ ìƒì„±: [3.v0.3-thumbnail-system.md](./3.v0.3-thumbnail-system.md)
- í˜¸ë²„ í”„ë¦¬ë·°: [4.v0.4-thumbnail-hover-preview.md](./4.v0.4-thumbnail-hover-preview.md)

---

## ğŸ“ ë¼ì´ì„ ìŠ¤

ì´ í”„ë¡œì íŠ¸ëŠ” êµìœ¡ ëª©ì ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.
