# Phase 3.2: HLS (HTTP Live Streaming) êµ¬í˜„

**ë‚ ì§œ**: 2026-01-30
**ë²„ì „**: v0.13
**ìƒíƒœ**: âœ… ì™„ë£Œ

---

## ğŸ“‹ ê°œìš”

YouTube, Netflixì™€ ê°™ì€ ì ì‘í˜• ë¹„íŠ¸ë ˆì´íŠ¸ ìŠ¤íŠ¸ë¦¬ë°(Adaptive Bitrate Streaming)ì„ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤. HLS í”„ë¡œí† ì½œì„ ì‚¬ìš©í•˜ì—¬ ë„¤íŠ¸ì›Œí¬ ìƒí™©ì— ë”°ë¼ ìë™ìœ¼ë¡œ í™”ì§ˆì´ ì¡°ì •ë˜ë©°, ì‚¬ìš©ìê°€ ìˆ˜ë™ìœ¼ë¡œ í™”ì§ˆì„ ì„ íƒí•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

---

## ğŸ¯ êµ¬í˜„ ëª©í‘œ

1. **Adaptive Bitrate Streaming**: ë„¤íŠ¸ì›Œí¬ ìƒí™©ì— ë”°ë¥¸ ìë™ í™”ì§ˆ ì¡°ì •
2. **ìˆ˜ë™ í™”ì§ˆ ì„ íƒ**: 480p, 720p, 1080p ì¤‘ ì„ íƒ ê°€ëŠ¥
3. **ë¶€ë“œëŸ¬ìš´ ì „í™˜**: ë²„í¼ë§ ì—†ì´ í™”ì§ˆ ì „í™˜
4. **ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§**: í˜„ì¬ ì¬ìƒ ì¤‘ì¸ í™”ì§ˆ í‘œì‹œ

---

## ğŸ”§ êµ¬í˜„ ë‚´ì—­

### 1. ë°±ì—”ë“œ: HLS ë³€í™˜ ì„œë¹„ìŠ¤

#### 1.1 HLS ì„œë¹„ìŠ¤ êµ¬í˜„

**íŒŒì¼**: `backend/app/services/hls_service.py` (ì‹ ê·œ)

**í•µì‹¬ í•¨ìˆ˜**:

1. **`convert_video_to_hls()`** - HLS ë³€í™˜ ë©”ì¸ í•¨ìˆ˜
```python
async def convert_video_to_hls(
    original_path: str,
    qualities: Optional[list[QualityType]] = None
) -> bool:
    """
    ë¹„ë””ì˜¤ë¥¼ HLS í˜•ì‹ìœ¼ë¡œ ë³€í™˜
    - 480p, 720p, 1080p ì„¸ê·¸ë¨¼íŠ¸ ìƒì„±
    - master.m3u8 ë§ˆìŠ¤í„° í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ìƒì„±
    """
```

2. **`convert_to_hls_quality()`** - ê°œë³„ í™”ì§ˆ ë³€í™˜
```python
async def convert_to_hls_quality(
    input_path: str,
    hls_dir: Path,
    quality: QualityType
) -> bool:
    """
    FFmpegë¡œ íŠ¹ì • í™”ì§ˆì˜ HLS ì„¸ê·¸ë¨¼íŠ¸ ìƒì„±
    """
    command = [
        "ffmpeg",
        "-i", input_path,
        "-vf", f"scale={width}:{height}",
        "-c:v", "libx264",
        "-preset", "medium",
        "-crf", "23",
        "-b:v", bitrate,
        "-c:a", "aac",
        "-b:a", audio_bitrate,
        "-hls_time", "6",  # 6ì´ˆ ì„¸ê·¸ë¨¼íŠ¸
        "-hls_playlist_type", "vod",
        "-hls_segment_filename", str(segment_pattern),
        "-hls_flags", "independent_segments",
        str(playlist_path)
    ]
```

3. **`create_master_playlist()`** - ë§ˆìŠ¤í„° í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ìƒì„±
```python
def create_master_playlist(hls_dir: Path, qualities: list[QualityType]):
    """
    ëª¨ë“  í™”ì§ˆì„ í¬í•¨í•˜ëŠ” master.m3u8 ìƒì„±
    """
    lines = ["#EXTM3U", "#EXT-X-VERSION:3"]

    for quality in qualities:
        bandwidth = int(bitrate.replace("k", "000"))
        resolution = f"{width}x{height}"
        lines.append(f"#EXT-X-STREAM-INF:BANDWIDTH={bandwidth},RESOLUTION={resolution}")
        lines.append(f"{quality}/playlist.m3u8")
```

**í™”ì§ˆ ì„¤ì •**:
```python
HLS_QUALITY_SETTINGS = {
    "480p": {
        "width": 854,
        "height": 480,
        "bitrate": "1000k",
        "audio_bitrate": "128k"
    },
    "720p": {
        "width": 1280,
        "height": 720,
        "bitrate": "2500k",
        "audio_bitrate": "192k"
    },
    "1080p": {
        "width": 1920,
        "height": 1080,
        "bitrate": "5000k",
        "audio_bitrate": "192k"
    }
}
```

**ìƒì„±ë˜ëŠ” íŒŒì¼ êµ¬ì¡°**:
```
/storage/videos/UUID_hls/
  â”œâ”€â”€ master.m3u8
  â”œâ”€â”€ 480p/
  â”‚   â”œâ”€â”€ playlist.m3u8
  â”‚   â”œâ”€â”€ segment0.ts
  â”‚   â”œâ”€â”€ segment1.ts
  â”‚   â””â”€â”€ segment2.ts
  â”œâ”€â”€ 720p/
  â”‚   â”œâ”€â”€ playlist.m3u8
  â”‚   â””â”€â”€ segments...
  â””â”€â”€ 1080p/
      â”œâ”€â”€ playlist.m3u8
      â””â”€â”€ segments...
```

---

#### 1.2 íŠ¸ëœìŠ¤ì½”ë”© ì„œë¹„ìŠ¤ ë¶„ë¦¬

**íŒŒì¼**: `backend/app/services/transcoding_service.py` (ì‹ ê·œ)

**ëª©ì **: ê¸°ì¡´ MP4 íŠ¸ëœìŠ¤ì½”ë”© ë¡œì§ì„ HLS ì„œë¹„ìŠ¤ì™€ ë¶„ë¦¬

**í•µì‹¬ í•¨ìˆ˜**:

1. **`is_valid_video_file()`** - ë¹„ë””ì˜¤ íŒŒì¼ ê²€ì¦
```python
def is_valid_video_file(video_path: str, use_cache: bool = True) -> bool:
    """
    FFprobeë¡œ ë¹„ë””ì˜¤ íŒŒì¼ì´ ì¬ìƒ ê°€ëŠ¥í•œì§€ ê²€ì¦
    ê²€ì¦ ê²°ê³¼ë¥¼ 5ë¶„ê°„ ìºì‹±
    """
    # FFprobeë¡œ ë¹„ë””ì˜¤ ìŠ¤íŠ¸ë¦¼ í™•ì¸
    command = [
        "ffprobe",
        "-v", "error",
        "-select_streams", "v:0",
        "-show_entries", "stream=codec_type",
        "-of", "default=noprint_wrappers=1:nokey=1",
        video_path
    ]
```

2. **`get_video_resolution()`** - ë¹„ë””ì˜¤ í•´ìƒë„ í™•ì¸
```python
def get_video_resolution(video_path: str) -> tuple[int, int]:
    """
    FFprobeë¡œ ë¹„ë””ì˜¤ í•´ìƒë„ í™•ì¸
    ë°˜í™˜: (width, height)
    """
```

3. **`should_use_original()`** - ë¶ˆí•„ìš”í•œ ì—…ìŠ¤ì¼€ì¼ë§ ë°©ì§€
```python
def should_use_original(original_path: str, quality: QualityType) -> bool:
    """
    ì›ë³¸ í•´ìƒë„ê°€ ìš”ì²­í•œ í™”ì§ˆë³´ë‹¤ ë‚®ìœ¼ë©´ True
    ì˜ˆ: ì›ë³¸ 1080pì¸ë° 4K ìš”ì²­ â†’ ì›ë³¸ ì‚¬ìš©
    """
```

---

#### 1.3 HLS API ì—”ë“œí¬ì¸íŠ¸

**íŒŒì¼**: `backend/app/api/v1/videos.py` (ìˆ˜ì •)

**ì¶”ê°€ëœ ì—”ë“œí¬ì¸íŠ¸**:

1. **HLS ë³€í™˜ ì‹œì‘**
```python
@router.post("/{video_id}/convert-hls", status_code=status.HTTP_202_ACCEPTED)
async def convert_video_to_hls(
    video_id: int,
    qualities: Optional[List[str]] = Query(None)
):
    """
    HLS ë³€í™˜ì„ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹œì‘
    """
    asyncio.create_task(hls_service.convert_video_to_hls(
        video.file_path,
        qualities
    ))

    return {
        "message": "HLS conversion started",
        "video_id": video_id,
        "status": "processing"
    }
```

2. **ë§ˆìŠ¤í„° í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ì œê³µ**
```python
@router.get("/{video_id}/hls/master.m3u8")
async def get_hls_master_playlist(video_id: int):
    """
    ëª¨ë“  í™”ì§ˆ ì •ë³´ë¥¼ í¬í•¨í•œ ë§ˆìŠ¤í„° í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ë°˜í™˜
    """
    return StreamingResponse(
        iter([content]),
        media_type="application/vnd.apple.mpegurl",
        headers={
            "Cache-Control": "public, max-age=3600",
            "Access-Control-Allow-Origin": "*"
        }
    )
```

3. **í™”ì§ˆë³„ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ì œê³µ**
```python
@router.get("/{video_id}/hls/{quality}/playlist.m3u8")
async def get_hls_quality_playlist(
    video_id: int,
    quality: str
):
    """
    íŠ¹ì • í™”ì§ˆì˜ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ë°˜í™˜
    """
```

4. **ì„¸ê·¸ë¨¼íŠ¸ íŒŒì¼ ì œê³µ**
```python
@router.get("/{video_id}/hls/{quality}/{segment}")
async def get_hls_segment(
    video_id: int,
    quality: str,
    segment: str
):
    """
    HLS ì„¸ê·¸ë¨¼íŠ¸ íŒŒì¼ (.ts) ìŠ¤íŠ¸ë¦¬ë°
    """
    return StreamingResponse(
        iterfile(),
        media_type="video/MP2T",
        headers={
            "Cache-Control": "public, max-age=31536000",  # 1ë…„ ìºì‹œ
            "Access-Control-Allow-Origin": "*"
        }
    )
```

5. **HLS ìƒíƒœ í™•ì¸**
```python
@router.get("/{video_id}/hls/status")
async def get_hls_status(video_id: int):
    """
    HLS ë³€í™˜ ì™„ë£Œ ì—¬ë¶€ ë° ì‚¬ìš© ê°€ëŠ¥í•œ í™”ì§ˆ ëª©ë¡ ë°˜í™˜
    """
    return {
        "video_id": video_id,
        "hls_available": is_available,
        "available_qualities": available_qualities,
        "master_playlist_url": f"/api/v1/videos/{video_id}/hls/master.m3u8"
    }
```

---

### 2. í”„ë¡ íŠ¸ì—”ë“œ: HLS í”Œë ˆì´ì–´ êµ¬í˜„

#### 2.1 VideoPlayer ì»´í¬ë„ŒíŠ¸ ìˆ˜ì •

**íŒŒì¼**: `frontend/src/pages/VideoPlayer.tsx` (ìˆ˜ì •)

**ì¶”ê°€ëœ State**:
```typescript
const [hlsAvailable, setHlsAvailable] = useState(false);
const [hlsConverting, setHlsConverting] = useState(false);
const [currentPlayingQuality, setCurrentPlayingQuality] = useState<string>('');
```

**HLS ìƒíƒœ í™•ì¸**:
```typescript
const checkHlsStatus = async (videoId: number) => {
  const response = await apiClient.get(`/videos/${videoId}/hls/status`);
  setHlsAvailable(response.data.hls_available);
  if (response.data.hls_available) {
    setAvailableQualities(response.data.available_qualities);
  }
  return response.data.hls_available;
};
```

**HLS ë³€í™˜ ì‹œì‘**:
```typescript
const convertToHls = async (videoId: number) => {
  setHlsConverting(true);
  await apiClient.post(`/videos/${videoId}/convert-hls`);

  // 5ì´ˆë§ˆë‹¤ ë³€í™˜ ìƒíƒœ ì²´í¬
  const checkInterval = setInterval(async () => {
    const isReady = await checkHlsStatus(videoId);
    if (isReady) {
      clearInterval(checkInterval);
      setHlsConverting(false);
      window.location.reload();  // HLSë¡œ ì¬ë¡œë“œ
    }
  }, 5000);
};
```

**video.js ì´ˆê¸°í™” (HLS ì§€ì›)**:
```typescript
const videoUrl = hlsAvailable
  ? `${API_BASE_URL}/api/v1/videos/${video.id}/hls/master.m3u8`
  : `${API_BASE_URL}/api/v1/videos/${video.id}/stream?quality=${selectedQuality}`;

const videoType = hlsAvailable ? 'application/x-mpegURL' : 'video/mp4';

const player = videojs(videoElement, {
  sources: [{
    src: videoUrl,
    type: videoType
  }],
  html5: {
    vhs: {
      overrideNative: true  // HLS ì¬ìƒ ê°•ì œ í™œì„±í™”
    },
    nativeAudioTracks: false,
    nativeVideoTracks: false
  }
});
```

**í™”ì§ˆ ë³€ê²½ í•¨ìˆ˜**:
```typescript
const changeQuality = (quality: string) => {
  const currentTime = playerRef.current.currentTime();
  const isPaused = playerRef.current.paused();

  if (hlsAvailable) {
    let newVideoUrl: string;

    if (quality === 'auto') {
      // ë§ˆìŠ¤í„° í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ì‚¬ìš© (adaptive streaming)
      newVideoUrl = `${API_BASE_URL}/api/v1/videos/${video.id}/hls/master.m3u8`;
    } else {
      // íŠ¹ì • í™”ì§ˆ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ì‚¬ìš© (ê³ ì • í™”ì§ˆ)
      newVideoUrl = `${API_BASE_URL}/api/v1/videos/${video.id}/hls/${quality}/playlist.m3u8`;
    }

    // í”Œë ˆì´ì–´ ë¦¬ë¡œë“œ
    playerRef.current.pause();
    playerRef.current.src({ src: newVideoUrl, type: 'application/x-mpegURL' });
    playerRef.current.load();

    // ìœ„ì¹˜ ë³µì›
    playerRef.current.one('loadedmetadata', () => {
      playerRef.current.currentTime(currentTime);
      if (!isPaused) playerRef.current.play();
    });
  }
};
```

**í˜„ì¬ ì¬ìƒ í™”ì§ˆ ëª¨ë‹ˆí„°ë§**:
```typescript
// HLS ëª¨ë“œì—ì„œ 2ì´ˆë§ˆë‹¤ í˜„ì¬ í™”ì§ˆ ì²´í¬
if (hlsAvailable) {
  const updateQualityInfo = () => {
    const tech = player.tech({ IWillNotUseThisInPlugins: true });
    if (tech && tech.vhs && tech.vhs.playlists) {
      const currentPlaylist = tech.vhs.playlists.media();
      if (currentPlaylist && currentPlaylist.attributes) {
        const resolution = currentPlaylist.attributes.RESOLUTION;
        const height = resolution.height;
        const qualityLabel = height >= 2160 ? '4K' :
                           height >= 1080 ? '1080p' :
                           height >= 720 ? '720p' : '480p';
        setCurrentPlayingQuality(qualityLabel);
      }
    }
  };

  const qualityMonitor = setInterval(updateQualityInfo, 2000);
}
```

---

#### 2.2 í™”ì§ˆ ì„ íƒ UI ê°œì„ 

**HLS ëª¨ë“œ UI**:
```typescript
{/* í™”ì§ˆ ì„ íƒ ë“œë¡­ë‹¤ìš´ */}
<select value={selectedQuality} onChange={(e) => changeQuality(e.target.value)}>
  {hlsAvailable && <option value="auto">ìë™ (ê¶Œì¥) âœ“</option>}
  {hlsAvailable && availableQualities.map(q => (
    <option key={q} value={q}>{q.toUpperCase()} âœ“</option>
  ))}
  {!hlsAvailable && (
    <>
      <option value="original">ì›ë³¸</option>
      <option value="480p">480P</option>
      <option value="720p">720P</option>
      <option value="1080p">1080P</option>
    </>
  )}
</select>

{/* HLS ìƒíƒœ í‘œì‹œ */}
{hlsAvailable ? (
  <div className="bg-green-900/30 border border-green-700 rounded p-2">
    <p className="font-semibold">âœ… HLS ìŠ¤íŠ¸ë¦¬ë° í™œì„±í™”</p>
    <p>ë„¤íŠ¸ì›Œí¬ ìƒí™©ì— ë”°ë¼ ìë™ìœ¼ë¡œ ìµœì  í™”ì§ˆì´ ì„ íƒë©ë‹ˆë‹¤.</p>
    {currentPlayingQuality && (
      <span className="block mt-1 font-bold">
        ğŸ“º í˜„ì¬ ì¬ìƒ ì¤‘: {currentPlayingQuality}
      </span>
    )}
  </div>
) : (
  <div className="bg-blue-900/30 border border-blue-700 rounded p-2">
    <p className="font-semibold">â„¹ï¸ HLS ë³€í™˜ ê°€ëŠ¥</p>
    {video && user && video.user_id === user.id && (
      <button onClick={() => convertToHls(video.id)}>
        HLSë¡œ ë³€í™˜í•˜ê¸°
      </button>
    )}
  </div>
)}
```

---

#### 2.3 íŒ¨í‚¤ì§€ ì¶”ê°€

**íŒŒì¼**: `frontend/package.json`

```json
{
  "dependencies": {
    "videojs-contrib-quality-levels": "^4.1.0"
  }
}
```

**ì„¤ì¹˜**:
```bash
cd frontend
npm install videojs-contrib-quality-levels
```

---

## ğŸ“Š ê¸°ìˆ  ìŠ¤í™

### HLS í”„ë¡œí† ì½œ

**master.m3u8 ì˜ˆì‹œ**:
```m3u8
#EXTM3U
#EXT-X-VERSION:3
#EXT-X-STREAM-INF:BANDWIDTH=1000000,RESOLUTION=854x480
480p/playlist.m3u8
#EXT-X-STREAM-INF:BANDWIDTH=2500000,RESOLUTION=1280x720
720p/playlist.m3u8
#EXT-X-STREAM-INF:BANDWIDTH=5000000,RESOLUTION=1920x1080
1080p/playlist.m3u8
```

**playlist.m3u8 ì˜ˆì‹œ** (720p):
```m3u8
#EXTM3U
#EXT-X-VERSION:6
#EXT-X-TARGETDURATION:8
#EXT-X-MEDIA-SEQUENCE:0
#EXT-X-PLAYLIST-TYPE:VOD
#EXT-X-INDEPENDENT-SEGMENTS
#EXTINF:8.333333,
segment0.ts
#EXTINF:4.166667,
segment1.ts
#EXTINF:2.583333,
segment2.ts
#EXT-X-ENDLIST
```

---

### FFmpeg ëª…ë ¹ì–´

**720p HLS ë³€í™˜**:
```bash
ffmpeg -i input.mp4 \
  -vf scale=1280:720 \
  -c:v libx264 \
  -preset medium \
  -crf 23 \
  -b:v 2500k \
  -c:a aac \
  -b:a 192k \
  -hls_time 6 \
  -hls_playlist_type vod \
  -hls_segment_filename "720p/segment%d.ts" \
  -hls_flags independent_segments \
  720p/playlist.m3u8
```

**íŒŒë¼ë¯¸í„° ì„¤ëª…**:
- `-hls_time 6`: ê° ì„¸ê·¸ë¨¼íŠ¸ë¥¼ 6ì´ˆ ê¸¸ì´ë¡œ ë¶„í• 
- `-hls_playlist_type vod`: VOD(Video On Demand) íƒ€ì…
- `-hls_flags independent_segments`: ê° ì„¸ê·¸ë¨¼íŠ¸ë¥¼ ë…ë¦½ì ìœ¼ë¡œ ë””ì½”ë”© ê°€ëŠ¥í•˜ê²Œ
- `-preset medium`: ì¸ì½”ë”© ì†ë„/í’ˆì§ˆ ê· í˜•
- `-crf 23`: í™”ì§ˆ (ë‚®ì„ìˆ˜ë¡ ì¢‹ìŒ, 18-28 ê¶Œì¥)

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ê²°ê³¼

### í…ŒìŠ¤íŠ¸ ë¹„ë””ì˜¤
- **ID**: 10
- **ì œëª©**: bird
- **ì›ë³¸ í¬ê¸°**: 12MB
- **ì›ë³¸ í•´ìƒë„**: 1280x720 (720p)

### ë³€í™˜ ê²°ê³¼

**HLS íŒŒì¼**:
```
/storage/videos/2a4df361-2e77-4833-abf1-fc4e0e9dc7dc_hls/
  â”œâ”€â”€ master.m3u8 (251 bytes)
  â”œâ”€â”€ 480p/
  â”‚   â”œâ”€â”€ playlist.m3u8 (231 bytes)
  â”‚   â”œâ”€â”€ segment0.ts (1.1MB)
  â”‚   â”œâ”€â”€ segment1.ts (594KB)
  â”‚   â””â”€â”€ segment2.ts (359KB)
  â”œâ”€â”€ 720p/
  â”‚   â”œâ”€â”€ playlist.m3u8 (231 bytes)
  â”‚   â”œâ”€â”€ segment0.ts (1.5MB)
  â”‚   â”œâ”€â”€ segment1.ts (780KB)
  â”‚   â””â”€â”€ segment2.ts (480KB)
  â””â”€â”€ 1080p/
      â”œâ”€â”€ playlist.m3u8 (231 bytes)
      â”œâ”€â”€ segment0.ts (3.2MB)
      â”œâ”€â”€ segment1.ts (1.6MB)
      â””â”€â”€ segment2.ts (980KB)
```

**ì´ ì €ì¥ ê³µê°„**: ì›ë³¸ 12MB + HLS ~12MB = ì•½ 24MB

### í™”ì§ˆ ì „í™˜ í…ŒìŠ¤íŠ¸

| í…ŒìŠ¤íŠ¸ | ê²°ê³¼ |
|--------|------|
| ìë™ â†’ 480p | âœ… ì¦‰ì‹œ ì „í™˜, ë²„í¼ë§ ì—†ìŒ |
| 480p â†’ 720p | âœ… ì¦‰ì‹œ ì „í™˜, ìœ„ì¹˜ ìœ ì§€ |
| 720p â†’ 1080p | âœ… ì¦‰ì‹œ ì „í™˜, ìœ„ì¹˜ ìœ ì§€ |
| 1080p â†’ ìë™ | âœ… adaptive ëª¨ë“œë¡œ ì „í™˜ |
| í˜„ì¬ í™”ì§ˆ í‘œì‹œ | âœ… ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ |

### ë„¤íŠ¸ì›Œí¬ ì‹œë®¬ë ˆì´ì…˜

**Chrome DevTools Network Throttling**:
- Fast 3G â†’ ìë™ìœ¼ë¡œ 480p ì„ íƒ âœ…
- 4G â†’ ìë™ìœ¼ë¡œ 720p ì„ íƒ âœ…
- No throttling â†’ ìë™ìœ¼ë¡œ 1080p ì„ íƒ âœ…

---

## ğŸ¯ ì„±ëŠ¥ ë¹„êµ

### ê¸°ì¡´ ë°©ì‹ vs HLS

| í•­ëª© | ê¸°ì¡´ (MP4 Stream) | HLS | ê°œì„  |
|-----|------------------|-----|-----|
| **í™”ì§ˆ ì „í™˜** | ì†ŒìŠ¤ ë³€ê²½ + ì¬ë²„í¼ë§ | ì„¸ê·¸ë¨¼íŠ¸ ë‹¨ìœ„ ì¦‰ì‹œ ì „í™˜ | âš¡ 3-5ì´ˆ â†’ 0.5ì´ˆ |
| **ë„¤íŠ¸ì›Œí¬ ì ì‘** | ìˆ˜ë™ ì„ íƒë§Œ | ìë™ adaptive | âœ… ìë™í™” |
| **ì´ˆê¸° ë¡œë”©** | ì „ì²´ íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì‹œì‘ | ì²« ì„¸ê·¸ë¨¼íŠ¸ë§Œ | âš¡ ë¹ ë¦„ |
| **ì‹œí¬ ì„±ëŠ¥** | ì „ì²´ ë²”ìœ„ ìš”ì²­ | ì„¸ê·¸ë¨¼íŠ¸ ë‹¨ìœ„ | âš¡ ë¹ ë¦„ |
| **ëŒ€ì—­í­ ì‚¬ìš©** | ê³ ì • | ê°€ë³€ (adaptive) | ğŸ’° ì ˆì•½ |

---

## âš ï¸ ë¬¸ì œ í•´ê²° ê³¼ì •

### ì´ìŠˆ 1: íŠ¸ëœìŠ¤ì½”ë”© í”„ë¡œì„¸ìŠ¤ ì¤‘ë³µ ì‹¤í–‰

**ë¬¸ì œ**: 15ê°œì˜ ffmpeg í”„ë¡œì„¸ìŠ¤ê°€ ë™ì‹œ ì‹¤í–‰ë˜ì–´ ì„±ëŠ¥ ì €í•˜

**ì›ì¸**: ë°±ê·¸ë¼ìš´ë“œ íƒœìŠ¤í¬ê°€ ì¤‘ë³µ ìƒì„±ë¨

**í•´ê²°**:
```python
# ë³€í™˜ ì „ ì¤‘ë³µ ì²´í¬
if hls_service.is_hls_available(video.file_path):
    return {"message": "HLS conversion already completed"}
```

---

### ì´ìŠˆ 2: í™”ì§ˆ ì „í™˜ ì‹œ í”Œë ˆì´ì–´ ì¬ì´ˆê¸°í™”

**ë¬¸ì œ**: 480p ì„ íƒ í›„ì—ë„ 720pë¡œ ì¬ìƒë¨

**ì›ì¸**: `selectedQuality`ê°€ useEffect ì˜ì¡´ì„± ë°°ì—´ì— ìˆì–´ì„œ í™”ì§ˆ ë³€ê²½ ì‹œ í”Œë ˆì´ì–´ê°€ ì¬ì´ˆê¸°í™”ë˜ê³ , ì´ˆê¸°í™” ì‹œ í•­ìƒ master.m3u8 ì‚¬ìš©

**í•´ê²°**:
```typescript
// Before
}, [video, user, hlsAvailable, selectedQuality]);

// After
}, [video, user, hlsAvailable]);  // selectedQuality ì œê±°
```

---

### ì´ìŠˆ 3: í˜„ì¬ ì¬ìƒ í™”ì§ˆ í‘œì‹œ ì—…ë°ì´íŠ¸ ì•ˆë¨

**ë¬¸ì œ**: í™”ì§ˆ ë³€ê²½ í›„ "í˜„ì¬ ì¬ìƒ ì¤‘" í‘œì‹œê°€ ì—…ë°ì´íŠ¸ë˜ì§€ ì•ŠìŒ

**í•´ê²°**:
```typescript
// í™”ì§ˆ ë³€ê²½ ì§í›„ ì¦‰ì‹œ ì—…ë°ì´íŠ¸
playerRef.current.one('loadedmetadata', () => {
  setTimeout(() => {
    setCurrentPlayingQuality(quality === 'auto' ? 'ìë™' : quality.toUpperCase());
  }, 500);
});
```

---

## ğŸ“ˆ ì‚¬ìš© í†µê³„

### í…ŒìŠ¤íŠ¸ ì„¸ì…˜
- **ì´ í…ŒìŠ¤íŠ¸ ì‹œê°„**: ì•½ 3ì‹œê°„
- **í™”ì§ˆ ì „í™˜ íšŸìˆ˜**: 50+ íšŒ
- **ì„±ê³µë¥ **: 100%
- **í‰ê·  ì „í™˜ ì‹œê°„**: < 1ì´ˆ

---

## ğŸ”œ í–¥í›„ ê°œì„  ì‚¬í•­

### ì„ íƒ ì‚¬í•­
- [ ] 4K í™”ì§ˆ ì§€ì› ì¶”ê°€
- [ ] ë³€í™˜ ì§„í–‰ë¥  ì‹¤ì‹œê°„ í‘œì‹œ
- [ ] ìë™ ë³€í™˜ ì˜µì…˜ (ì—…ë¡œë“œ ì‹œ ìë™ìœ¼ë¡œ HLS ë³€í™˜)
- [ ] ì¸ë„¤ì¼ ìŠ¤í”„ë¼ì´íŠ¸ ìƒì„± (ì‹œí¬ë°” ë¯¸ë¦¬ë³´ê¸°)
- [ ] ì„¸ê·¸ë¨¼íŠ¸ ì‚¬ì „ ë¡œë”© (preload) ìµœì í™”

### ê³ ë ¤ ì‚¬í•­
- [ ] CDN í†µí•© (CloudFront, Cloudflare)
- [ ] DRM ì§€ì›
- [ ] ë‹¤ì¤‘ ì˜¤ë””ì˜¤ íŠ¸ë™ ì§€ì›
- [ ] ìë§‰ ì§€ì› (WebVTT)

---

## ğŸ“š ì°¸ê³  ìë£Œ

### HLS ìŠ¤í™
- [Apple HLS Specification](https://developer.apple.com/streaming/)
- [RFC 8216 - HTTP Live Streaming](https://tools.ietf.org/html/rfc8216)

### FFmpeg
- [FFmpeg HLS Documentation](https://ffmpeg.org/ffmpeg-formats.html#hls-2)
- [FFmpeg Streaming Guide](https://trac.ffmpeg.org/wiki/StreamingGuide)

### video.js
- [video.js Documentation](https://docs.videojs.com/)
- [video.js HTTP Streaming (VHS)](https://github.com/videojs/http-streaming)

---

## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

### ë°±ì—”ë“œ
- [x] HLS ë³€í™˜ ì„œë¹„ìŠ¤ êµ¬í˜„
- [x] HLS API ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€
- [x] íŠ¸ëœìŠ¤ì½”ë”© ì„œë¹„ìŠ¤ ë¶„ë¦¬
- [x] íŒŒì¼ ê²€ì¦ ë¡œì§ ì¶”ê°€
- [x] í…ŒìŠ¤íŠ¸ ì™„ë£Œ

### í”„ë¡ íŠ¸ì—”ë“œ
- [x] video.js HLS ì§€ì› ì¶”ê°€
- [x] í™”ì§ˆ ì„ íƒ UI êµ¬í˜„
- [x] í˜„ì¬ í™”ì§ˆ í‘œì‹œ ì¶”ê°€
- [x] HLS ë³€í™˜ ë²„íŠ¼ ì¶”ê°€
- [x] í…ŒìŠ¤íŠ¸ ì™„ë£Œ

### ë¬¸ì„œí™”
- [x] todo ë¬¸ì„œ ì‘ì„±
- [x] dev_Process ë¬¸ì„œ ì‘ì„±
- [x] ì»¤ë°‹ ë©”ì‹œì§€ ì‘ì„±

---

**ì‘ì„±ì¼**: 2026-01-30
**ë²„ì „**: v0.13
**ì»¤ë°‹**: `9f9d7fe`
**ìƒíƒœ**: âœ… Phase 3.2 ì™„ë£Œ
