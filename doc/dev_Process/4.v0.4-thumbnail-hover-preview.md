# v0.4 - ì¸ë„¤ì¼ í˜¸ë²„ í”„ë¦¬ë·° ê¸°ëŠ¥ (Thumbnail Hover Preview)

## ğŸ“‹ ê¸°ëŠ¥ ê°œìš”

ë¹„ë””ì˜¤ ëª©ë¡ì—ì„œ ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë ¸ì„ ë•Œ YouTube ìŠ¤íƒ€ì¼ì˜ ì¸ë„¤ì¼ ì• ë‹ˆë©”ì´ì…˜ í”„ë¦¬ë·° ê¸°ëŠ¥

### ì£¼ìš” ê¸°ëŠ¥
- ë§ˆìš°ìŠ¤ í˜¸ë²„ ì‹œ ì¸ë„¤ì¼ ìˆœí™˜ í‘œì‹œ (12ê°œ)
- 300ms ë””ë°”ìš´ìŠ¤ (ì‹¤ìˆ˜ë¡œ ë§ˆìš°ìŠ¤ê°€ ì§€ë‚˜ê°€ëŠ” ê²½ìš° ë°©ì§€)
- 1ì´ˆ ê°„ê²© ìë™ ìˆœí™˜
- Intersection Observerë¥¼ í†µí•œ ì„±ëŠ¥ ìµœì í™”
- ì¸ë„¤ì¼ í”„ë¦¬ë¡œë”© (ë¶€ë“œëŸ¬ìš´ ì „í™˜)
- ì§„í–‰ í‘œì‹œê¸° (í˜„ì¬ ëª‡ ë²ˆì§¸ ì¸ë„¤ì¼ì¸ì§€ í‘œì‹œ)

---

## ğŸ¬ ì‚¬ìš©ì ê²½í—˜ í”Œë¡œìš°

```mermaid
stateDiagram-v2
    [*] --> Idle: ë¹„ë””ì˜¤ ì¹´ë“œ ë Œë”ë§
    Idle --> Debouncing: ë§ˆìš°ìŠ¤ í˜¸ë²„
    Debouncing --> Animating: 300ms í›„
    Debouncing --> Idle: ë§ˆìš°ìŠ¤ ì•„ì›ƒ (300ms ì´ë‚´)
    Animating --> Cycling: 1ì´ˆë§ˆë‹¤
    Cycling --> Cycling: ë‹¤ìŒ ì¸ë„¤ì¼
    Cycling --> Idle: ë§ˆìš°ìŠ¤ ì•„ì›ƒ
    Animating --> Idle: ë§ˆìš°ìŠ¤ ì•„ì›ƒ

    note right of Debouncing
        ì‹¤ìˆ˜ë¡œ ì§€ë‚˜ê°€ëŠ”
        ë§ˆìš°ìŠ¤ ë°©ì§€
    end note

    note right of Cycling
        12ê°œ ì¸ë„¤ì¼ ìˆœí™˜
        (circular)
    end note
```

---

## ğŸ—ï¸ ì»´í¬ë„ŒíŠ¸ ì•„í‚¤í…ì²˜

```mermaid
graph TB
    subgraph "Videos Page"
        A[Videos.tsx]
    end

    subgraph "VideoCard Component"
        B[VideoCard.tsx]
        C[Thumbnail Image]
        D[Progress Indicators]
        E[Video Info]
    end

    subgraph "React Hooks"
        F[useState - thumbnails]
        G[useState - currentIndex]
        H[useState - isHovering]
        I[useState - isInView]
        J[useRef - cardRef]
        K[useRef - intervalRef]
        L[useRef - hoverTimeoutRef]
    end

    subgraph "Browser APIs"
        M[Intersection Observer]
        N[Image Preloading]
    end

    subgraph "Backend API"
        O[GET /videos/:id/thumbnails]
        P[GET /videos/:id/thumbnails/:tid/image]
    end

    A --> B
    B --> C
    B --> D
    B --> E
    B --> F
    B --> G
    B --> H
    B --> I
    B --> J
    B --> K
    B --> L
    B --> M
    B --> N
    B --> O
    B --> P
```

---

## ğŸ”„ ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨

### ì´ˆê¸° ë¡œë”© í”Œë¡œìš°

```mermaid
sequenceDiagram
    actor User
    participant Browser
    participant VideoCard
    participant IntersectionObserver
    participant API

    User->>Browser: í˜ì´ì§€ ìŠ¤í¬ë¡¤
    Browser->>IntersectionObserver: Viewport ì§„ì… ê°ì§€

    IntersectionObserver->>VideoCard: setIsInView(true)
    VideoCard->>API: GET /videos/{id}/thumbnails

    API-->>VideoCard: [thumbnail1, ..., thumbnail12]
    VideoCard->>VideoCard: setThumbnails([...])

    loop ê° ì¸ë„¤ì¼
        VideoCard->>Browser: new Image().src = thumbnail_url
        Browser->>Browser: ì´ë¯¸ì§€ í”„ë¦¬ë¡œë“œ
    end

    Note over VideoCard: ì¤€ë¹„ ì™„ë£Œ (í˜¸ë²„ ëŒ€ê¸°)
```

### í˜¸ë²„ ì• ë‹ˆë©”ì´ì…˜ í”Œë¡œìš°

```mermaid
sequenceDiagram
    actor User
    participant VideoCard
    participant Timers

    User->>VideoCard: ë§ˆìš°ìŠ¤ í˜¸ë²„

    VideoCard->>Timers: setTimeout(300ms)
    Note over Timers: ë””ë°”ìš´ìŠ¤ íƒ€ì´ë¨¸ ì‹œì‘

    alt 300ms ì´ë‚´ ë§ˆìš°ìŠ¤ ì•„ì›ƒ
        User->>VideoCard: ë§ˆìš°ìŠ¤ ì•„ì›ƒ
        VideoCard->>Timers: clearTimeout()
        Note over VideoCard: ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘ ì•ˆí•¨
    else 300ms ê²½ê³¼
        Timers->>VideoCard: íƒ€ì´ë¨¸ ë§Œë£Œ
        VideoCard->>VideoCard: setIsHovering(true)
        VideoCard->>Timers: setInterval(1000ms)

        loop 1ì´ˆë§ˆë‹¤
            Timers->>VideoCard: ì¸í„°ë²Œ ì½œë°±
            VideoCard->>VideoCard: currentIndex++
            VideoCard->>VideoCard: ì´ë¯¸ì§€ ë³€ê²½
            Note over VideoCard: ë‹¤ìŒ ì¸ë„¤ì¼ í‘œì‹œ
        end

        User->>VideoCard: ë§ˆìš°ìŠ¤ ì•„ì›ƒ
        VideoCard->>Timers: clearInterval()
        VideoCard->>VideoCard: setIsHovering(false)
        VideoCard->>VideoCard: currentIndex = 0
        Note over VideoCard: ì²« ë²ˆì§¸ ì¸ë„¤ì¼ë¡œ ë³µê·€
    end
```

---

## ğŸ’» ì½”ë“œ êµ¬í˜„

### VideoCard.tsx ì£¼ìš” ì½”ë“œ

#### 1. State ê´€ë¦¬
```typescript
const [thumbnails, setThumbnails] = useState<Thumbnail[]>([]);
const [currentThumbnailIndex, setCurrentThumbnailIndex] = useState(0);
const [isHovering, setIsHovering] = useState(false);
const [isInView, setIsInView] = useState(false);

const cardRef = useRef<HTMLDivElement>(null);
const intervalRef = useRef<NodeJS.Timeout | null>(null);
const hoverTimeoutRef = useRef<NodeJS.Timeout | null>(null);
```

#### 2. Intersection Observer (ì§€ì—° ë¡œë”©)
```typescript
useEffect(() => {
  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          setIsInView(true);
        }
      });
    },
    { threshold: 0.1 }  // 10% ë³´ì´ë©´ íŠ¸ë¦¬ê±°
  );

  if (cardRef.current) {
    observer.observe(cardRef.current);
  }

  return () => {
    if (cardRef.current) {
      observer.unobserve(cardRef.current);
    }
  };
}, []);
```

#### 3. ì¸ë„¤ì¼ ë¡œë”© ë° í”„ë¦¬ë¡œë“œ
```typescript
useEffect(() => {
  if (isInView && thumbnails.length === 0) {
    loadThumbnails();
  }
}, [isInView]);

const loadThumbnails = async () => {
  try {
    const response = await apiClient.get(`/videos/${video.id}/thumbnails`);
    setThumbnails(response.data);

    // í”„ë¦¬ë¡œë“œ
    response.data.forEach((thumbnail: Thumbnail) => {
      const img = new Image();
      img.src = `${API_URL}/videos/${video.id}/thumbnails/${thumbnail.id}/image`;
    });
  } catch (err) {
    console.error('Failed to load thumbnails:', err);
  }
};
```

#### 4. í˜¸ë²„ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ (300ms ë””ë°”ìš´ìŠ¤)
```typescript
const handleMouseEnter = () => {
  if (hoverTimeoutRef.current) {
    clearTimeout(hoverTimeoutRef.current);
  }

  hoverTimeoutRef.current = setTimeout(() => {
    setIsHovering(true);
    if (thumbnails.length > 1) {
      intervalRef.current = setInterval(() => {
        setCurrentThumbnailIndex((prev) => (prev + 1) % thumbnails.length);
      }, 1000);
    }
  }, 300);
};

const handleMouseLeave = () => {
  if (hoverTimeoutRef.current) {
    clearTimeout(hoverTimeoutRef.current);
    hoverTimeoutRef.current = null;
  }

  if (intervalRef.current) {
    clearInterval(intervalRef.current);
    intervalRef.current = null;
  }

  setIsHovering(false);
  setCurrentThumbnailIndex(0);
};
```

#### 5. ì¸ë„¤ì¼ URL ì„ íƒ
```typescript
const getThumbnailUrl = () => {
  if (isHovering && thumbnails.length > 0) {
    const thumbnail = thumbnails[currentThumbnailIndex];
    return `${API_URL}/videos/${video.id}/thumbnails/${thumbnail.id}/image`;
  }
  return `${API_URL}/videos/${video.id}/thumbnail`;  // ì„ íƒëœ ì¸ë„¤ì¼
};
```

#### 6. ì§„í–‰ í‘œì‹œê¸°
```tsx
{isHovering && thumbnails.length > 1 && (
  <div className="absolute top-2 right-2 flex gap-1">
    {thumbnails.map((_, index) => (
      <div
        key={index}
        className={`h-1 rounded-full transition-all ${
          index === currentThumbnailIndex
            ? 'w-4 bg-white'
            : 'w-1 bg-white/50'
        }`}
      />
    ))}
  </div>
)}
```

---

## ğŸ“ íŒŒì¼ êµ¬ì¡°

```
frontend/src/
â”œâ”€â”€ pages/
â”‚   â””â”€â”€ Videos.tsx                    # ë¹„ë””ì˜¤ ëª©ë¡ í˜ì´ì§€
â”œâ”€â”€ components/
â”‚   â””â”€â”€ video/
â”‚       â””â”€â”€ VideoCard.tsx             # ì¸ë„¤ì¼ í˜¸ë²„ í”„ë¦¬ë·° ì»´í¬ë„ŒíŠ¸
â””â”€â”€ services/
    â””â”€â”€ api.client.ts                 # API í´ë¼ì´ì–¸íŠ¸
```

### Videos.tsx ë³€ê²½ ì‚¬í•­
```typescript
// Before
<Link to={`/videos/${video.id}`}>
  <img src={thumbnail} />
  <h3>{video.title}</h3>
</Link>

// After
<VideoCard video={video} />
```

---

## ğŸ¨ UI/UX ë””ìì¸

### ë ˆì´ì•„ì›ƒ êµ¬ì¡°

```mermaid
graph TB
    A[VideoCard - Link ì»´í¬ë„ŒíŠ¸] --> B[ì¸ë„¤ì¼ ì˜ì—­ - aspect-video]
    A --> C[ë¹„ë””ì˜¤ ì •ë³´ ì˜ì—­ - p-4]

    B --> D[ì¸ë„¤ì¼ ì´ë¯¸ì§€]
    B --> E[ì¬ìƒ ì‹œê°„ - ìš°í•˜ë‹¨]
    B --> F[ì§„í–‰ í‘œì‹œê¸° - ìš°ìƒë‹¨]

    C --> G[ì œëª© - truncate]
    C --> H[ì„¤ëª… - line-clamp-2]
    C --> I[ì—…ë¡œë”/ì¡°íšŒìˆ˜]
    C --> J[ê¸¸ì´/ë‚ ì§œ]

    style B fill:#1f2937
    style C fill:#111827
    style F fill:#6366f1
```

### ì‹œê°ì  í”¼ë“œë°±

| ìƒíƒœ | íš¨ê³¼ |
|------|------|
| ê¸°ë³¸ | ì„ íƒëœ ì¸ë„¤ì¼ í‘œì‹œ |
| í˜¸ë²„ (0-300ms) | ë³€í™” ì—†ìŒ (ë””ë°”ìš´ìŠ¤) |
| í˜¸ë²„ (300ms+) | ì¸ë„¤ì¼ ìˆœí™˜ ì‹œì‘ |
| í˜¸ë²„ ì¤‘ | ring-2 ring-indigo-500 |
| ì§„í–‰ í‘œì‹œ | í˜„ì¬: w-4 bg-white<br/>ë‚˜ë¨¸ì§€: w-1 bg-white/50 |

---

## âš¡ ì„±ëŠ¥ ìµœì í™”

### 1. Intersection Observer ì‚¬ìš©

**ëª©ì **: ë·°í¬íŠ¸ì— ë³´ì´ëŠ” ì¹´ë“œë§Œ ì¸ë„¤ì¼ ë¡œë“œ

**íš¨ê³¼**:
- ì´ˆê¸° ë¡œë”© ì‹œê°„ ë‹¨ì¶•
- ë„¤íŠ¸ì›Œí¬ ìš”ì²­ ìµœì†Œí™”
- ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ê°ì†Œ

**ì„¤ì •**:
```typescript
{ threshold: 0.1 }  // 10% ë³´ì´ë©´ ë¡œë“œ
```

### 2. ì´ë¯¸ì§€ í”„ë¦¬ë¡œë”©

**ëª©ì **: ì¸ë„¤ì¼ ì „í™˜ ì‹œ ê¹œë¹¡ì„ ë°©ì§€

**êµ¬í˜„**:
```typescript
response.data.forEach((thumbnail: Thumbnail) => {
  const img = new Image();
  img.src = thumbnailUrl;  // ë¸Œë¼ìš°ì € ìºì‹œì— ì €ì¥
});
```

### 3. ë””ë°”ìš´ìŠ¤ (300ms)

**ëª©ì **: ë¶ˆí•„ìš”í•œ ì• ë‹ˆë©”ì´ì…˜ ë°©ì§€

**íš¨ê³¼**:
- ì‹¤ìˆ˜ë¡œ ë§ˆìš°ìŠ¤ê°€ ì§€ë‚˜ê°€ëŠ” ê²½ìš° ë¬´ì‹œ
- CPU ì‚¬ìš©ëŸ‰ ê°ì†Œ
- API ìš”ì²­ ê°ì†Œ

### 4. ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€

```typescript
useEffect(() => {
  return () => {
    if (intervalRef.current) {
      clearInterval(intervalRef.current);
    }
    if (hoverTimeoutRef.current) {
      clearTimeout(hoverTimeoutRef.current);
    }
  };
}, []);
```

---

## ğŸ› ï¸ ìœ ì§€ë³´ìˆ˜ ê°€ì´ë“œ

### ì„¤ì • ë³€ê²½

#### 1. ë””ë°”ìš´ìŠ¤ ì‹œê°„ ë³€ê²½
```typescript
// VideoCard.tsx (95ë²ˆì§¸ ì¤„)
hoverTimeoutRef.current = setTimeout(() => {
  // ...
}, 300);  // 300 -> 500 (ë” ëŠë¦¬ê²Œ)
```

#### 2. ìˆœí™˜ ì†ë„ ë³€ê²½
```typescript
// VideoCard.tsx (99ë²ˆì§¸ ì¤„)
intervalRef.current = setInterval(() => {
  // ...
}, 1000);  // 1000 -> 1500 (ë” ëŠë¦¬ê²Œ)
```

#### 3. Intersection Observer ì„ê³„ê°’ ë³€ê²½
```typescript
// VideoCard.tsx (52ë²ˆì§¸ ì¤„)
{ threshold: 0.1 }  // 0.1 -> 0.5 (50% ë³´ì—¬ì•¼ ë¡œë“œ)
```

#### 4. ì§„í–‰ í‘œì‹œê¸° ìŠ¤íƒ€ì¼ ë³€ê²½
```typescript
// VideoCard.tsx (200-204ë²ˆì§¸ ì¤„)
className={`h-1 rounded-full transition-all ${
  index === currentThumbnailIndex
    ? 'w-4 bg-white'        // í˜„ì¬: ë„ˆë¹„ 4, í°ìƒ‰
    : 'w-1 bg-white/50'     // ë‚˜ë¨¸ì§€: ë„ˆë¹„ 1, ë°˜íˆ¬ëª…
}`}
```

### ë¬¸ì œ í•´ê²°

#### 1. ì¸ë„¤ì¼ì´ ìˆœí™˜í•˜ì§€ ì•ŠìŒ
**ì›ì¸**: ì¸ë„¤ì¼ì´ 1ê°œë§Œ ì¡´ì¬
**í•´ê²°**: ë¹„ë””ì˜¤ ì—…ë¡œë“œ ì‹œ ì¸ë„¤ì¼ì´ 12ê°œ ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸

```bash
curl http://localhost:8000/api/v1/videos/{video_id}/thumbnails | jq length
# ì¶œë ¥: 12
```

#### 2. í˜¸ë²„ ì‹œ ê¹œë¹¡ì„
**ì›ì¸**: ì´ë¯¸ì§€ í”„ë¦¬ë¡œë”© ì‹¤íŒ¨
**í•´ê²°**: ë„¤íŠ¸ì›Œí¬ íƒ­ì—ì„œ ì´ë¯¸ì§€ ë¡œë”© í™•ì¸

#### 3. ë§ˆìš°ìŠ¤ ì•„ì›ƒ í›„ì—ë„ ê³„ì† ìˆœí™˜
**ì›ì¸**: clearInterval ëˆ„ë½
**í•´ê²°**: handleMouseLeave í•¨ìˆ˜ í™•ì¸

#### 4. ì„±ëŠ¥ ì €í•˜ (ë§ì€ ì¹´ë“œ)
**í˜„ìƒ**: ìŠ¤í¬ë¡¤ì´ ë²„ë²…ì„
**ì›ì¸**: Intersection Observer ë¯¸ì‘ë™
**í•´ê²°**:
```typescript
// cardRefê°€ ì œëŒ€ë¡œ ì—°ê²°ë˜ì—ˆëŠ”ì§€ í™•ì¸
console.log(cardRef.current);  // div ìš”ì†Œê°€ ì¶œë ¥ë˜ì–´ì•¼ í•¨
```

---

## ğŸ“Š ì„±ëŠ¥ ì¸¡ì •

### ë„¤íŠ¸ì›Œí¬ ìš”ì²­

| ì‹œë‚˜ë¦¬ì˜¤ | API ìš”ì²­ ìˆ˜ | ì´ë¯¸ì§€ ìš”ì²­ ìˆ˜ |
|---------|------------|--------------|
| ëª©ë¡ ë¡œë“œ (20ê°œ) | 1 | 20 (ì„ íƒëœ ì¸ë„¤ì¼) |
| ì¹´ë“œ 1ê°œ ë·°í¬íŠ¸ ì§„ì… | 1 | 12 (í”„ë¦¬ë¡œë“œ) |
| í˜¸ë²„ | 0 | 0 (ìºì‹œ ì‚¬ìš©) |

### ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰

- ì¸ë„¤ì¼ 1ê°œ: ~10KB (WebP)
- ì¹´ë“œ 1ê°œ í”„ë¦¬ë¡œë“œ: ~120KB (12ê°œ)
- ì¹´ë“œ 20ê°œ: ~2.4MB

**ìµœì í™”**: Intersection Observerë¡œ í•„ìš”í•œ ì¹´ë“œë§Œ ë¡œë“œ

---

## ğŸ¯ ì‚¬ìš©ì í”¼ë“œë°± ì²˜ë¦¬

### A. ë””ë°”ìš´ìŠ¤ ì‹œê°„ ì¡°ì • ê·¼ê±°

**í…ŒìŠ¤íŠ¸ ê²°ê³¼**:
- 100ms: ë„ˆë¬´ ë¯¼ê° (ì˜ë„í•˜ì§€ ì•Šì€ í˜¸ë²„ ë§ìŒ)
- 200ms: ì•½ê°„ ë¯¼ê°
- 300ms: ì ì ˆ âœ…
- 500ms: ë°˜ì‘ì´ ëŠë¦° ëŠë‚Œ

**ì„ íƒ**: 300ms

### B. ìˆœí™˜ ì†ë„ ì¡°ì • ê·¼ê±°

**í…ŒìŠ¤íŠ¸ ê²°ê³¼**:
- 500ms: ë„ˆë¬´ ë¹ ë¦„ (ì •ì‹  ì—†ìŒ)
- 1000ms: ì ì ˆ âœ…
- 1500ms: ë„ˆë¬´ ëŠë¦¼ (ì§€ë£¨í•¨)

**ì„ íƒ**: 1000ms (1ì´ˆ)

---

## ğŸ”„ í–¥í›„ ê°œì„  ì‚¬í•­

### 1. ë§ˆìš°ìŠ¤ ìœ„ì¹˜ ê¸°ë°˜ íƒìƒ‰
```typescript
// ë§ˆìš°ìŠ¤ X ìœ„ì¹˜ì— ë”°ë¼ íŠ¹ì • ì¸ë„¤ì¼ í‘œì‹œ
const handleMouseMove = (e: MouseEvent) => {
  const rect = e.currentTarget.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const index = Math.floor((x / rect.width) * thumbnails.length);
  setCurrentThumbnailIndex(index);
};
```

### 2. ë¯¸ë¦¬ë³´ê¸° ì¬ìƒ (GIF/WebM)
- ì§§ì€ ë¹„ë””ì˜¤ í´ë¦½ ìƒì„± (2-3ì´ˆ)
- í˜¸ë²„ ì‹œ ì¬ìƒ

### 3. ì¸ë„¤ì¼ í’ˆì§ˆ ì„ íƒ
- ì´ˆê¸° ë¡œë“œ: ì €í’ˆì§ˆ (ì‘ì€ íŒŒì¼)
- í˜¸ë²„ ì‹œ: ê³ í’ˆì§ˆ

---

## ğŸ”„ ì—…ë°ì´íŠ¸ ì´ë ¥

| ë²„ì „ | ë‚ ì§œ | ë³€ê²½ ë‚´ìš© |
|------|------|-----------|
| v0.4.0 | 2026-01-07 | ì¸ë„¤ì¼ í˜¸ë²„ í”„ë¦¬ë·° ê¸°ëŠ¥ êµ¬í˜„ |
| v0.4.1 | 2026-01-07 | Intersection Observer ì¶”ê°€ (ì„±ëŠ¥ ìµœì í™”) |
| v0.4.2 | 2026-01-07 | 300ms ë””ë°”ìš´ìŠ¤ ì¶”ê°€ |
