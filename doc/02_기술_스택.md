# 02. 기술 스택

> 라즈베리파이 4B/5 (8GB RAM) 환경에 최적화된 경량 스택

## 프론트엔드

### 핵심 프레임워크
- **React 18+**: UI 컴포넌트 라이브러리
- **TypeScript**: 타입 안정성 및 개발 생산성 향상
- **Vite**: 빠른 개발 서버 및 빌드 도구

### 상태 관리
- **Zustand**: 경량 전역 상태 관리 (~1KB)
- **React Query**: 서버 상태 관리 및 캐싱
- ~~Redux Toolkit~~ (라즈베리파이에는 과도)

### UI/UX
- **Tailwind CSS**: 유틸리티 우선 CSS 프레임워크
- **Shadcn/ui**: 경량 컴포넌트 라이브러리 (헤드리스 UI 기반)
- **CSS Animations**: 네이티브 CSS transition (Framer Motion 대신)
- **다크 모드**: Netflix 스타일 색상 팔레트

### 비디오 플레이어
- **Video.js**: 커스터마이징 가능한 HTML5 플레이어
- **HTTP Range Requests**: 직접 스트리밍 (HLS 불필요)
  - 트랜스코딩 최소화로 CPU 부하 감소

### 레이아웃
- **YouTube 스타일 격자 레이아웃**: 썸네일 중심의 그리드 UI
- **반응형 디자인**: 모바일/태블릿/데스크톱 대응

### 라우팅
- **React Router v6**: SPA 라우팅

## 백엔드

### 핵심 프레임워크
- **FastAPI**: 고성능 비동기 웹 프레임워크
  - 자동 API 문서 생성 (Swagger/OpenAPI)
  - Pydantic을 통한 데이터 검증
  - 비동기 I/O 지원 (파일 스트리밍)
  - **단일 Worker 프로세스** (메모리 최적화)
  - **Uvicorn**: ASGI 서버

### 인증 & 보안
- **JWT (JSON Web Tokens)**: 토큰 기반 인증
- **bcrypt**: 비밀번호 해싱
- **python-jose**: JWT 처리
- **CORS Middleware**: Cross-Origin 요청 처리
- **역할 기반 접근 제어 (RBAC)**: user, admin, premium

### 데이터베이스
- **PostgreSQL 14+**: 메인 관계형 데이터베이스
  - 트랜잭션 지원
  - **GIN 인덱스**: 태그 조합 검색 최적화
  - **Full-Text Search**: 제목 키워드 검색
  - **메모리 최적화 설정**:
    - `shared_buffers`: 256MB
    - `max_connections`: 20
    - `work_mem`: 4MB

### ORM & 마이그레이션
- **SQLAlchemy 2.0**: Python ORM
  - 비동기 지원 (asyncpg 드라이버)
- **Alembic**: 데이터베이스 마이그레이션

### 파일 스토리지
- **로컬 파일 시스템**: 외장 하드 4TB (NAS)
  - `/mnt/videos`: 원본 비디오 저장
  - `/mnt/thumbnails`: 썸네일 이미지 저장
- ~~Redis~~ (불필요: 3-100명 규모에는 과도)
- ~~MinIO~~ (불필요: 로컬 스토리지로 충분)

### 비디오 처리
- **FFmpeg**: 비디오 메타데이터 추출, 썸네일 생성
  - **장면 전환 감지**: `select='gt(scene,0.3)'` 필터
  - **ARM 최적화**: 소프트웨어 디코딩 (`-hwaccel auto` 회피)
  - **썸네일 생성**: 자동 장면 감지 + 관리자 커스텀 업로드
- **FFmpeg-python**: Python FFmpeg 래퍼
- **직접 스트리밍**: HTTP Range Requests (206 Partial Content)
  - 트랜스코딩 최소화 (재생 불가능한 코덱만)

### 검색 시스템
- **제목 키워드 검색** (1순위):
  - PostgreSQL Full-Text Search (한국어 지원)
- **태그 조합 검색** (2순위):
  - 체크박스 + 연산자 UI (포함/제외)
  - 다중 태그 AND/OR 조합
  - GIN 인덱스 활용

## 개발 도구

### 코드 품질
- **Black**: Python 코드 포매터
- **Flake8**: Linter
- **mypy**: 타입 체킹
- **ESLint**: JavaScript/TypeScript Linter
- **Prettier**: 코드 포매터

### 테스팅
- **pytest**: Python 유닛/통합 테스트
- **pytest-asyncio**: 비동기 테스트
- **Jest**: JavaScript 테스트
- **React Testing Library**: React 컴포넌트 테스트
- **Playwright** 또는 **Cypress**: E2E 테스트

### API 문서
- **Swagger UI**: FastAPI 자동 생성
- **ReDoc**: 대안 API 문서 뷰

### 버전 관리
- **Git**: 소스 코드 버전 관리
- **GitHub** 또는 **GitLab**: 코드 호스팅

## 인프라 & 배포

### 서버 환경
- **하드웨어**: 라즈베리파이 4B 또는 5 (8GB RAM)
- **OS**: 라즈비안 + CasaOS
- **스토리지**: 외장 하드 4TB (NAS)
- **네트워크**: 외부 IP + 포트포워딩

### 컨테이너화
- **Docker 단일 컨테이너** (올인원):
  - Nginx (리버스 프록시 + React 정적 파일)
  - FastAPI (백엔드 API)
  - PostgreSQL (데이터베이스)
- **Alpine Linux 베이스**: 최소 이미지 크기
- **Multi-stage Build**: 빌드 캐시 최적화

### 메모리 할당 목표
- **Nginx**: ~50MB
- **FastAPI**: ~200MB (단일 워커)
- **PostgreSQL**: ~100MB (최소 설정)
- **FFmpeg**: ~50MB (온디맨드)
- **여유 메모리**: ~600MB (OS + 버퍼)
- **총합**: < 1GB (8GB RAM의 12.5%)

### 배포 방식
- **CasaOS App Store**: 커스텀 앱 등록
- **docker-compose.yml**: 로컬 개발 환경
- **볼륨 마운트**: `/mnt/videos`, `/mnt/thumbnails`

### 모니터링 (최소화)
- **Docker stats**: 리소스 모니터링
- **FastAPI 로깅**: 파일 기반 로그
- ~~Prometheus/Grafana~~ (라즈베리파이에는 과도)
- ~~Sentry~~ (초기에는 불필요)

## 개발 환경

### 필수 요구사항
- **Python 3.11+**
- **Node.js 18+**
- **PostgreSQL 14+**
- **FFmpeg**

### 권장 IDE
- **VS Code**: 통합 개발 환경
  - Python Extension
  - ESLint Extension
  - Prettier Extension
  - GitLens

## 아키텍처 패턴

### 백엔드
- **계층형 아키텍처** (Layered Architecture)
  - API Layer (라우터)
  - Service Layer (비즈니스 로직)
  - Repository Layer (데이터 접근)
  - Model Layer (데이터 모델)
- **모놀리식 설계**: 단일 컨테이너, 단순한 배포

### 프론트엔드
- **컴포넌트 기반 아키텍처**
  - Atomic Design 패턴 (간소화)
  - Container/Presenter 패턴

### API 설계
- **RESTful API**: 표준 HTTP 메서드
- **HTTP Range Requests**: 비디오 스트리밍
- ~~WebSocket~~ (실시간 기능 불필요)

## 성능 최적화 전략

### 라즈베리파이 최적화
1. **메모리 절약**:
   - 단일 FastAPI 워커
   - PostgreSQL 최소 설정
   - React 빌드 최적화 (코드 스플리팅)

2. **CPU 절약**:
   - 트랜스코딩 최소화 (직접 스트리밍)
   - 썸네일 생성 큐잉 (백그라운드)
   - 인덱스 최적화 (GIN, Full-Text)

3. **네트워크 최적화**:
   - Nginx gzip 압축
   - React 정적 파일 캐싱
   - HTTP 206 Partial Content (비디오 청크)

## 확장성 고려사항

### 현재 목표 (MVP)
- **동시 접속**: 3명 → 100명
- **비디오 수**: 100개 → 5,000개
- **스토리지**: 100GB → 5TB

### 향후 확장 옵션 (Phase 3)
- **다중 화질 지원**: 480p, 720p, 1080p, 4K
- **HTTPS 적용**: Let's Encrypt
- ~~마이크로서비스~~ (불필요: 단순함 유지)
- ~~메시지 큐~~ (불필요: 백그라운드 작업 충분)
- ~~CDN~~ (초기에는 불필요)
