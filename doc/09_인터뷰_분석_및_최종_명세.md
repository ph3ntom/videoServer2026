# 09. 인터뷰 분석 및 최종 프로젝트 명세

## 인터뷰 일자
2025년 1월 5일

## 분석 개요
사용자와의 상세 인터뷰를 통해 프로젝트의 방향성과 기술적 제약사항을 명확히 파악했습니다.

---

## 📊 주요 변경사항 요약

### 1. 인프라 제약사항 (Critical)
```
서버: 라즈베리파이 4B/5 (8GB RAM)
스토리지: 외장 하드 4TB (NAS)
OS: 라즈비안 + CasaOS
배포: Docker 단일 컨테이너 (올인원)
네트워크: 외부 IP + 포트포워딩 (HTTPS 추후)
```

**영향:**
- ⚠️ 트랜스코딩 최소화 (필요시만)
- ⚠️ 가벼운 아키텍처 필수
- ⚠️ 메모리 사용 최적화
- ⚠️ 동시 업로드 제한 필요

### 2. UI/UX 변경
```diff
- Netflix 스타일 가로 스크롤 레이아웃
+ YouTube 스타일 격자 레이아웃

- 0.5초 썸네일 변경 간격
+ 1초 썸네일 변경 간격 (장면 전환 감지)

- 버튼 클릭 태그 선택 (1번: 포함, 2번: 제외)
+ 체크박스 + 연산자 선택 방식
```

### 3. 제거된 기능
- ❌ 댓글 시스템 (불필요)
- ❌ 소셜 공유 기능 (불필요)
- ❌ 플레이리스트 (태그/카테고리로 대체)
- ❌ 다운로드 기능 (온라인 전용)
- ❌ 라이브 스트리밍 (불필요)
- ❌ 실시간 알림 (불필요)

### 4. 우선순위 재조정

#### MVP (2개월) - 절대 필수
1. ✅ **제목 키워드 검색** (1순위)
2. ✅ **태그 조합 검색** (2순위)
3. ✅ **썸네일 자동 생성** (장면 전환 감지)
4. ✅ **썸네일 호버 미리보기** (1초 간격)
5. ✅ **Admin 전용 비디오 등록**
6. ✅ **카테고리 브라우징**

#### Phase 2 (4개월) - 중요
1. 평점 시스템 (별점 1-5)
2. 시청 완료 표시
3. 시청 중인 비디오 이어보기
4. 시청 기록 삭제

#### Phase 3 (6개월) - 선택적
1. 다중 화질 지원 (480p, 720p, 1080p, 4K)
2. 자막 지원 (한국어)
3. Premium 역할 (프리미엄 콘텐츠)
4. HTTPS 적용

---

## 🎯 최종 프로젝트 목표

### 프로젝트 명
**StreamFlix** - 라즈베리파이 기반 경량 스트리밍 플랫폼

### 핵심 가치
1. **효율성**: 라즈베리파이에서도 원활하게 동작
2. **직관성**: 태그 조합으로 빠른 비디오 검색
3. **심플함**: 필요한 기능만 구현
4. **확장성**: 개인용 → 소규모 조직 (100명)

### 예상 사용자
- **초기**: 3명 (개인/가족)
- **6개월**: 10명 (친구/소규모 그룹)
- **1년**: 100명 (커뮤니티)

### 콘텐츠 규모
- **초기**: 100개 비디오 (~100GB)
- **1년**: 5000개 비디오 (~5TB)
- **평균 크기**: 1GB/비디오
- **스토리지**: 4TB HDD (확장 가능)

---

## 🔧 기술 스택 최종 확정

### 백엔드
```
FastAPI (Python 3.11+)
├─ 비동기 I/O (aiofiles)
├─ 최소 메모리 사용
└─ 라즈베리파이 최적화

PostgreSQL 14+ (경량 설정)
├─ 최소 커넥션 풀
└─ 인덱스 최적화

FFmpeg
├─ 장면 전환 감지 썸네일
├─ 메타데이터 추출
└─ 필요시 트랜스코딩 (최소화)

선택적: Redis (매우 낮은 우선순위)
```

### 프론트엔드
```
React 18 + TypeScript + Vite
├─ 격자 레이아웃 (YouTube 스타일)
├─ 다크 모드
└─ 대형 썸네일

Tailwind CSS
└─ 가시성 중심 디자인

React Player 또는 Video.js
└─ Range 요청 지원
```

### 배포
```
Docker 단일 컨테이너 (올인원)
├─ Backend + Frontend + PostgreSQL
├─ CasaOS 호환
└─ 간단한 설치/관리

외부 접근
├─ 포트포워딩
└─ HTTPS (추후)
```

---

## 📋 핵심 기능 명세

### 1. 검색 시스템 (최우선)

#### 1.1 제목 키워드 검색
```
GET /api/v1/search/videos?q=한국

응답: 제목/설명에 "한국" 포함된 비디오 목록
정렬: 관련성 > 최신순 > 인기순
```

#### 1.2 태그 조합 검색
```
UI: 체크박스 선택 방식

[태그 선택]
□ korea     [포함 ✓] [제외 ○]
□ SF        [포함 ✓] [제외 ○]
□ action    [포함 ○] [제외 ✓]
□ fun       [포함 ○] [제외 ○]

[검색] 버튼 클릭

API 요청:
GET /api/v1/search/videos/advanced
  ?include_tags=korea,SF
  &exclude_tags=action

결과: korea + SF - action
```

#### 1.3 카테고리 브라우징
```
카테고리 선택 → 해당 카테고리 비디오 목록
정렬 옵션: 최신순, 인기순, 평점순, 길이순
```

### 2. 썸네일 시스템 (핵심 기능)

#### 2.1 자동 생성
```python
# 장면 전환 감지 방식
ffmpeg -i video.mp4 \
  -filter:v "select='gt(scene,0.3)',showinfo" \
  -vsync 0 \
  thumbnails/thumb_%03d.jpg

생성 개수: 5-10개 (비디오 길이 기반)
저장: video_thumbnails 테이블
첫 번째 썸네일: 기본 선택
```

#### 2.2 관리자 선택
```
Admin 페이지:
- 자동 생성된 썸네일 그리드 표시
- 라디오 버튼으로 선택
- 외부 이미지 업로드 가능
- 선택 시 videos.thumbnail_path 업데이트
```

#### 2.3 호버 미리보기
```typescript
// 마우스 오버 시
- 1초 간격으로 썸네일 변경
- 자연스러운 페이드 애니메이션
- 순환 방식: 1→2→3→4→5→1 (반복)
- 줄거리 예상 가능하도록

// 최적화
- 썸네일 프리로드 (첫 진입 시)
- Debouncing (빠른 이동 시)
- Lazy loading (뷰포트)
```

### 3. 비디오 관리 (Admin 전용)

#### 3.1 업로드
```
- 지원 형식: mp4, mkv, avi, mov
- 크기 제한: 무제한 (서버 용량만 고려)
- 처리:
  1. 파일 저장 (외장 HDD)
  2. 메타데이터 추출 (FFmpeg)
  3. 장면 전환 감지 썸네일 생성
  4. 트랜스코딩 (필요시만)
     - 재생 불가능한 코덱만
     - 백그라운드 처리
```

#### 3.2 메타데이터
```
- 제목 (필수)
- 설명 (선택)
- 카테고리 선택 (다중)
- 태그 선택 (다중)
- 썸네일 선택
```

### 4. 사용자 역할

```
user (기본)
├─ 비디오 시청
├─ 검색 및 브라우징
└─ 평점 (추후)

admin
├─ 모든 user 권한
├─ 비디오 업로드/수정/삭제
├─ 썸네일 관리
└─ 태그 생성/관리

premium (추후)
├─ 모든 user 권한
└─ 프리미엄 비디오 접근
```

### 5. 태그 시스템

#### 5.1 태그 유형
```
관리자가 자유롭게 추가 (유형 구분 선택적)

예시:
- korea, western, japan, china, asian, animation
- romance, variety, action, SF
- fun, romantic, sad

특징:
- 대소문자 구분 없음
- 중복 불가
- slug 자동 생성
```

#### 5.2 태그 관리
```
Admin 페이지:
- 태그 생성 (name, type)
- 태그 수정
- 태그 삭제 (사용 중인 경우 경고)
- 태그 사용 통계
```

---

## 🏗️ 시스템 아키텍처 (최종)

### Docker 단일 컨테이너 구조
```
┌─────────────────────────────────────────┐
│    StreamFlix Docker Container          │
│                                         │
│  ┌───────────────────────────────────┐ │
│  │  Nginx (리버스 프록시)             │ │
│  │  - Frontend 서빙 (/)              │ │
│  │  - API 프록시 (/api)              │ │
│  └───────────────────────────────────┘ │
│                                         │
│  ┌───────────────────────────────────┐ │
│  │  React Frontend (빌드 결과)        │ │
│  │  - 정적 파일                       │ │
│  └───────────────────────────────────┘ │
│                                         │
│  ┌───────────────────────────────────┐ │
│  │  FastAPI Backend                   │ │
│  │  - Uvicorn (단일 워커)            │ │
│  │  - 비동기 I/O                     │ │
│  └───────────────────────────────────┘ │
│                                         │
│  ┌───────────────────────────────────┐ │
│  │  PostgreSQL                        │ │
│  │  - 최소 설정 (max_connections=20)│ │
│  └───────────────────────────────────┘ │
│                                         │
└─────────────────────────────────────────┘
           │
           ├─ Volume: /data (DB)
           └─ Volume: /media (비디오/썸네일)
                      → 외장 HDD 마운트
```

### 리소스 제약 고려
```
라즈베리파이 4B/5 (8GB RAM):
- Nginx: ~50MB
- React (정적): ~0MB (서빙만)
- FastAPI: ~200MB
- PostgreSQL: ~100MB
- 여유 메모리: ~7.5GB (비디오 스트리밍 버퍼)

최적화:
- PostgreSQL shared_buffers: 256MB
- FastAPI workers: 1 (단일 프로세스)
- 커넥션 풀: 5-10
- 파일 업로드: 청크 처리 (스트리밍)
```

---

## 🗄️ 데이터베이스 스키마 (간소화)

### 필수 테이블
```sql
users           -- 사용자
videos          -- 비디오
categories      -- 카테고리
video_categories -- 비디오-카테고리 (N:M)
tags            -- 태그
video_tags      -- 비디오-태그 (N:M)
video_thumbnails -- 썸네일
```

### Phase 2 (선택적)
```sql
ratings         -- 평점
watch_history   -- 시청 기록
user_favorites  -- 찜하기 (선택적)
```

### 제거된 테이블
```sql
❌ comments (댓글 불필요)
❌ playlists (플레이리스트 불필요)
❌ social_shares (소셜 불필요)
```

---

## 🎨 UI/UX 최종 설계

### 레이아웃
```
┌─────────────────────────────────────────┐
│  Header: Logo | 검색바 | 사용자 메뉴     │
├─────────────────────────────────────────┤
│  [태그 필터 바]                          │
│  ☐ korea ☐ SF ☐ action ☐ romance       │
│  [검색] [초기화]                         │
├─────────────────────────────────────────┤
│                                         │
│  ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐      │
│  │Video│ │Video│ │Video│ │Video│      │
│  │ 1   │ │ 2   │ │ 3   │ │ 4   │      │
│  └─────┘ └─────┘ └─────┘ └─────┘      │
│                                         │
│  ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐      │
│  │Video│ │Video│ │Video│ │Video│      │
│  │ 5   │ │ 6   │ │ 7   │ │ 8   │      │
│  └─────┘ └─────┘ └─────┘ └─────┘      │
│                                         │
│         [더 보기] 또는 무한 스크롤        │
└─────────────────────────────────────────┘
```

### 색상 테마
```css
/* 다크 모드 (Netflix 스타일) */
배경: #141414
카드 배경: #1f1f1f
텍스트: #e5e5e5
강조: #e50914 (빨강) 또는 커스텀
호버: 밝게
```

### VideoCard 컴포넌트
```typescript
// 호버 시 썸네일 미리보기
<div className="video-card">
  <div className="thumbnail-container">
    <img src={currentThumbnail} />
    {/* 1초 간격 자동 변경 */}
  </div>
  <h3 className="title">{video.title}</h3>
  <div className="tags">
    {video.tags.map(tag =>
      <span className="tag">{tag.name}</span>
    )}
  </div>
  <div className="meta">
    {video.duration} | {video.view_count} views
  </div>
</div>
```

---

## 📅 개발 일정 (최종)

### MVP (2개월)
```
Week 1-2: 환경 설정 및 기본 구조
- Docker 컨테이너 설정
- FastAPI + React 기본 구조
- PostgreSQL 연결

Week 3-4: 인증 및 사용자 관리
- JWT 인증
- Admin 미들웨어
- 최초 슈퍼 관리자 생성

Week 5-6: 비디오 업로드 및 썸네일
- 파일 업로드 (청크 처리)
- FFmpeg 장면 전환 감지
- 썸네일 자동 생성
- 메타데이터 추출

Week 7: 태그 시스템
- 태그 CRUD
- 비디오-태그 연결
- 태그 조합 검색 API

Week 8: 검색 시스템
- 제목 키워드 검색
- 고급 태그 검색 (포함/제외)
- 카테고리 브라우징

Week 9-10: 프론트엔드 (격자 레이아웃)
- 홈 페이지 (격자)
- 비디오 카드 + 호버 미리보기
- 태그 필터 UI (체크박스)
- 검색 페이지

Week 11: Admin 페이지
- 비디오 업로드 UI
- 썸네일 관리 페이지
- 태그 관리 페이지

Week 12: 통합 테스트 및 최적화
- 라즈베리파이 성능 테스트
- 메모리 사용 최적화
- 버그 수정
```

### Phase 2 (2-4개월)
```
- 평점 시스템
- 시청 기록 및 이어보기
- 시청 완료 표시
- 성능 튜닝
```

### Phase 3 (4-6개월)
```
- 다중 화질
- 자막 지원
- Premium 역할
- HTTPS
- 백업 시스템
```

---

## ✅ 성공 기준

### 기능적 요구사항
- [ ] 비디오 업로드 및 재생 정상 동작
- [ ] 태그 조합 검색 정확도 100%
- [ ] 썸네일 자동 생성 성공률 95%+
- [ ] 호버 미리보기 부드럽게 동작

### 비기능적 요구사항
- [ ] 로딩 시간 < 3초
- [ ] 동시 접속 3명 원활 (초기)
- [ ] 메모리 사용 < 2GB (백엔드+DB)
- [ ] 라즈베리파이에서 안정적 동작

### 사용성
- [ ] 원하는 비디오를 10초 안에 찾기
- [ ] 직관적인 태그 검색 UI
- [ ] 모바일에서도 사용 가능 (중간 우선순위)

---

## 🎯 다음 단계

1. ✅ **인터뷰 분석 완료**
2. ⏭️ **모든 문서 업데이트**
   - 프로젝트 개요
   - 기술 스택
   - 시스템 아키텍처
   - 데이터베이스 스키마
   - API 명세서
   - 개발 로드맵
3. ⏭️ **개발 착수**
   - Docker 환경 설정
   - 프로젝트 초기화
   - Phase 1 Week 1 시작
