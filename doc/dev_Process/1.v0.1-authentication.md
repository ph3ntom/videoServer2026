# v0.1 - ì¸ì¦ ì‹œìŠ¤í…œ (Authentication System)

## ğŸ“‹ ê¸°ëŠ¥ ê°œìš”

ì‚¬ìš©ì íšŒì›ê°€ì…, ë¡œê·¸ì¸, ì´ë©”ì¼ ì¸ì¦ ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” ì¸ì¦ ì‹œìŠ¤í…œ

### ì£¼ìš” ê¸°ëŠ¥
- ì‚¬ìš©ì íšŒì›ê°€ì… (ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸)
- ì´ë©”ì¼ ì¸ì¦ (6ìë¦¬ ì½”ë“œ)
- ë¡œê·¸ì¸ (JWT í† í° ë°œê¸‰)
- í† í° ê°±ì‹  (Refresh Token)
- ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ

---

## ğŸ”Œ API ì—”ë“œí¬ì¸íŠ¸

### 1. íšŒì›ê°€ì…
```http
POST /api/v1/auth/register
Content-Type: application/json

{
  "email": "user@example.com",
  "username": "username",
  "password": "password123"
}
```

**ì‘ë‹µ**
```json
{
  "id": 1,
  "email": "user@example.com",
  "username": "username",
  "is_active": false,
  "is_verified": false,
  "created_at": "2026-01-07T00:00:00Z"
}
```

### 2. ì´ë©”ì¼ ì¸ì¦ ì½”ë“œ ì „ì†¡
```http
POST /api/v1/auth/send-verification
Content-Type: application/json

{
  "email": "user@example.com"
}
```

### 3. ì´ë©”ì¼ ì¸ì¦
```http
POST /api/v1/auth/verify-email
Content-Type: application/json

{
  "email": "user@example.com",
  "code": "123456"
}
```

### 4. ë¡œê·¸ì¸
```http
POST /api/v1/auth/login
Content-Type: application/x-www-form-urlencoded

username=user@example.com&password=password123
```

**ì‘ë‹µ**
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIs...",
  "refresh_token": "eyJhbGciOiJIUzI1NiIs...",
  "token_type": "bearer"
}
```

### 5. í† í° ê°±ì‹ 
```http
POST /api/v1/auth/refresh
Content-Type: application/json

{
  "refresh_token": "eyJhbGciOiJIUzI1NiIs..."
}
```

### 6. í˜„ì¬ ì‚¬ìš©ì ì •ë³´
```http
GET /api/v1/auth/me
Authorization: Bearer {access_token}
```

---

## ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

```mermaid
erDiagram
    users {
        int id PK
        string email UK
        string username UK
        string hashed_password
        boolean is_active
        boolean is_verified
        datetime created_at
        datetime updated_at
    }

    email_verifications {
        int id PK
        int user_id FK
        string code
        datetime expires_at
        boolean is_used
        datetime created_at
    }

    users ||--o{ email_verifications : "has"
```

### users í…Œì´ë¸”
| ì»¬ëŸ¼ | íƒ€ì… | ì œì•½ | ì„¤ëª… |
|------|------|------|------|
| id | Integer | PK | ì‚¬ìš©ì ID |
| email | String(255) | UNIQUE, NOT NULL | ì´ë©”ì¼ |
| username | String(50) | UNIQUE, NOT NULL | ì‚¬ìš©ìëª… |
| hashed_password | String(255) | NOT NULL | í•´ì‹œëœ ë¹„ë°€ë²ˆí˜¸ |
| is_active | Boolean | DEFAULT true | í™œì„±í™” ì—¬ë¶€ |
| is_verified | Boolean | DEFAULT false | ì´ë©”ì¼ ì¸ì¦ ì—¬ë¶€ |
| created_at | DateTime | NOT NULL | ìƒì„± ì‹œê° |
| updated_at | DateTime | NOT NULL | ìˆ˜ì • ì‹œê° |

### email_verifications í…Œì´ë¸”
| ì»¬ëŸ¼ | íƒ€ì… | ì œì•½ | ì„¤ëª… |
|------|------|------|------|
| id | Integer | PK | ì¸ì¦ ID |
| user_id | Integer | FK(users.id) | ì‚¬ìš©ì ID |
| code | String(6) | NOT NULL | ì¸ì¦ ì½”ë“œ (6ìë¦¬) |
| expires_at | DateTime | NOT NULL | ë§Œë£Œ ì‹œê° |
| is_used | Boolean | DEFAULT false | ì‚¬ìš© ì—¬ë¶€ |
| created_at | DateTime | NOT NULL | ìƒì„± ì‹œê° |

---

## ğŸ”„ ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨

### íšŒì›ê°€ì… ë° ì´ë©”ì¼ ì¸ì¦ í”Œë¡œìš°

```mermaid
sequenceDiagram
    actor User
    participant Frontend
    participant API
    participant DB
    participant SMTP

    User->>Frontend: íšŒì›ê°€ì… ì •ë³´ ì…ë ¥
    Frontend->>API: POST /auth/register
    API->>DB: ì‚¬ìš©ì ìƒì„±
    DB-->>API: ì‚¬ìš©ì ID ë°˜í™˜
    API-->>Frontend: ì‚¬ìš©ì ì •ë³´ ë°˜í™˜

    User->>Frontend: ì´ë©”ì¼ ì¸ì¦ ìš”ì²­
    Frontend->>API: POST /auth/send-verification
    API->>DB: ì¸ì¦ ì½”ë“œ ìƒì„± ë° ì €ì¥
    API->>SMTP: ì´ë©”ì¼ ì „ì†¡
    SMTP-->>User: ì¸ì¦ ì½”ë“œ ì´ë©”ì¼

    User->>Frontend: ì¸ì¦ ì½”ë“œ ì…ë ¥
    Frontend->>API: POST /auth/verify-email
    API->>DB: ì½”ë“œ ê²€ì¦
    API->>DB: is_verified = true
    API-->>Frontend: ì¸ì¦ ì™„ë£Œ
```

### ë¡œê·¸ì¸ í”Œë¡œìš°

```mermaid
sequenceDiagram
    actor User
    participant Frontend
    participant API
    participant DB

    User->>Frontend: ë¡œê·¸ì¸ ì •ë³´ ì…ë ¥
    Frontend->>API: POST /auth/login
    API->>DB: ì‚¬ìš©ì ì¡°íšŒ
    DB-->>API: ì‚¬ìš©ì ì •ë³´
    API->>API: ë¹„ë°€ë²ˆí˜¸ ê²€ì¦
    API->>API: JWT í† í° ìƒì„±
    API-->>Frontend: Access & Refresh Token
    Frontend->>Frontend: í† í° ì €ì¥ (localStorage)

    Note over Frontend,API: ì´í›„ ëª¨ë“  ìš”ì²­ì— Access Token í¬í•¨

    Frontend->>API: API ìš”ì²­ (with token)
    API->>API: í† í° ê²€ì¦
    API->>DB: ë°ì´í„° ì¡°íšŒ/ìˆ˜ì •
    DB-->>API: ê²°ê³¼
    API-->>Frontend: ì‘ë‹µ
```

---

## ğŸ—ï¸ ì•„í‚¤í…ì²˜

```mermaid
graph TB
    subgraph "Frontend (React + TypeScript)"
        A[Register Page]
        B[Login Page]
        C[Auth Context]
        D[API Client]
    end

    subgraph "Backend (FastAPI)"
        E[Auth Router]
        F[Auth Service]
        G[JWT Manager]
        H[Password Hasher]
    end

    subgraph "Database (PostgreSQL)"
        I[(users)]
        J[(email_verifications)]
    end

    subgraph "External Services"
        K[SMTP Server]
    end

    A --> D
    B --> D
    D --> E
    C --> D
    E --> F
    F --> G
    F --> H
    F --> I
    F --> J
    F --> K
```

---

## ğŸ” ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

### 1. ë¹„ë°€ë²ˆí˜¸ ë³´ì•ˆ
- bcrypt í•´ì‹± ì•Œê³ ë¦¬ì¦˜ ì‚¬ìš©
- Salt ìë™ ìƒì„±
- ìµœì†Œ ê¸¸ì´ ì œí•œ

### 2. JWT í† í°
- Access Token: 30ë¶„ ìœ íš¨
- Refresh Token: 7ì¼ ìœ íš¨
- HS256 ì•Œê³ ë¦¬ì¦˜ ì‚¬ìš©
- SECRET_KEY í™˜ê²½ë³€ìˆ˜ë¡œ ê´€ë¦¬

### 3. ì´ë©”ì¼ ì¸ì¦
- 6ìë¦¬ ëœë¤ ì½”ë“œ
- 10ë¶„ ìœ íš¨ ì‹œê°„
- ì¼íšŒìš© (ì‚¬ìš© ì‹œ is_used = true)

### 4. CORS ì„¤ì •
- í—ˆìš©ëœ originë§Œ ì ‘ê·¼ ê°€ëŠ¥
- Credentials í—ˆìš©

---

## ğŸ“ íŒŒì¼ êµ¬ì¡°

```
backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ v1/
â”‚   â”‚       â””â”€â”€ auth.py              # ì¸ì¦ ë¼ìš°í„°
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ user.py                  # User ëª¨ë¸
â”‚   â”‚   â””â”€â”€ email_verification.py   # EmailVerification ëª¨ë¸
â”‚   â”œâ”€â”€ schemas/
â”‚   â”‚   â”œâ”€â”€ user.py                  # User ìŠ¤í‚¤ë§ˆ
â”‚   â”‚   â””â”€â”€ auth.py                  # Auth ìŠ¤í‚¤ë§ˆ
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ auth_service.py          # ì¸ì¦ ì„œë¹„ìŠ¤
â”‚   â”‚   â””â”€â”€ email_service.py         # ì´ë©”ì¼ ì„œë¹„ìŠ¤
â”‚   â””â”€â”€ core/
â”‚       â”œâ”€â”€ security.py              # JWT, ë¹„ë°€ë²ˆí˜¸ í•´ì‹±
â”‚       â””â”€â”€ config.py                # ì„¤ì •
â”‚
frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ Register.tsx             # íšŒì›ê°€ì… í˜ì´ì§€
â”‚   â”‚   â”œâ”€â”€ Login.tsx                # ë¡œê·¸ì¸ í˜ì´ì§€
â”‚   â”‚   â””â”€â”€ VerifyEmail.tsx          # ì´ë©”ì¼ ì¸ì¦ í˜ì´ì§€
â”‚   â”œâ”€â”€ contexts/
â”‚   â”‚   â””â”€â”€ AuthContext.tsx          # ì¸ì¦ ì»¨í…ìŠ¤íŠ¸
â”‚   â””â”€â”€ services/
â”‚       â””â”€â”€ api.client.ts            # API í´ë¼ì´ì–¸íŠ¸
```

---

## ğŸ› ï¸ ìœ ì§€ë³´ìˆ˜ ê°€ì´ë“œ

### ì½”ë“œ ìœ„ì¹˜

#### 1. ì‚¬ìš©ì ëª¨ë¸ ìˆ˜ì •
- **íŒŒì¼**: `backend/app/models/user.py`
- **ì£¼ì˜**: ìŠ¤í‚¤ë§ˆ ë³€ê²½ ì‹œ Alembic ë§ˆì´ê·¸ë ˆì´ì…˜ í•„ìš”

#### 2. JWT í† í° ì„¤ì • ë³€ê²½
- **íŒŒì¼**: `backend/app/core/security.py`
- **ì„¤ì •**:
  - `ACCESS_TOKEN_EXPIRE_MINUTES`: Access Token ìœ íš¨ ì‹œê°„
  - `REFRESH_TOKEN_EXPIRE_DAYS`: Refresh Token ìœ íš¨ ì‹œê°„
  - `ALGORITHM`: ì„œëª… ì•Œê³ ë¦¬ì¦˜

#### 3. ì´ë©”ì¼ í…œí”Œë¦¿ ìˆ˜ì •
- **íŒŒì¼**: `backend/app/services/email_service.py`
- **í•¨ìˆ˜**: `send_verification_email()`

#### 4. í”„ë¡ íŠ¸ì—”ë“œ ì¸ì¦ ë¡œì§
- **íŒŒì¼**: `frontend/src/contexts/AuthContext.tsx`
- **ì£¼ìš” í•¨ìˆ˜**:
  - `login()`: ë¡œê·¸ì¸ ì²˜ë¦¬
  - `logout()`: ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
  - `refreshToken()`: í† í° ê°±ì‹ 

### ì¼ë°˜ì ì¸ ë¬¸ì œ í•´ê²°

#### 1. ì´ë©”ì¼ ì „ì†¡ ì‹¤íŒ¨
```python
# backend/app/core/config.py
SMTP_HOST = "smtp.gmail.com"
SMTP_PORT = 587
SMTP_USER = "your-email@gmail.com"
SMTP_PASSWORD = "app-password"  # Gmail ì•± ë¹„ë°€ë²ˆí˜¸ ì‚¬ìš©
```

#### 2. JWT í† í° ê²€ì¦ ì‹¤íŒ¨
- SECRET_KEY í™•ì¸
- í† í° ë§Œë£Œ í™•ì¸
- í† í° í˜•ì‹ í™•ì¸ (Bearer {token})

#### 3. CORS ì—ëŸ¬
```python
# backend/app/main.py
app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://localhost:5174"],  # í”„ë¡ íŠ¸ì—”ë“œ URL
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

### í…ŒìŠ¤íŠ¸ ë°©ë²•

#### 1. íšŒì›ê°€ì… í…ŒìŠ¤íŠ¸
```bash
curl -X POST http://localhost:8000/api/v1/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@example.com",
    "username": "testuser",
    "password": "password123"
  }'
```

#### 2. ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸
```bash
curl -X POST http://localhost:8000/api/v1/auth/login \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "username=test@example.com&password=password123"
```

#### 3. ì¸ì¦ëœ ìš”ì²­ í…ŒìŠ¤íŠ¸
```bash
curl -X GET http://localhost:8000/api/v1/auth/me \
  -H "Authorization: Bearer {access_token}"
```

---

## ğŸ“Š ì„±ëŠ¥ ìµœì í™”

### 1. ë°ì´í„°ë² ì´ìŠ¤ ì¸ë±ìŠ¤
- `users.email`: UNIQUE ì¸ë±ìŠ¤
- `users.username`: UNIQUE ì¸ë±ìŠ¤
- `email_verifications.user_id`: ì™¸ë˜ í‚¤ ì¸ë±ìŠ¤

### 2. ë¹„ë°€ë²ˆí˜¸ í•´ì‹± ë¹„ìš©
```python
# bcrypt rounds: 12 (ê¸°ë³¸ê°’)
# ë³´ì•ˆê³¼ ì„±ëŠ¥ì˜ ê· í˜•
pwd_context = CryptContext(schemes=["bcrypt"], deprecated="auto")
```

### 3. í† í° ê²€ì¦ ìºì‹±
- í˜„ì¬ ë¯¸êµ¬í˜„
- í–¥í›„ Redis ìºì‹± ê³ ë ¤

---

## ğŸ”„ ì—…ë°ì´íŠ¸ ì´ë ¥

| ë²„ì „ | ë‚ ì§œ | ë³€ê²½ ë‚´ìš© |
|------|------|-----------|
| v0.1 | 2026-01-07 | ì´ˆê¸° ì¸ì¦ ì‹œìŠ¤í…œ êµ¬í˜„ |
