# 06. 개발 로드맵

> 라즈베리파이 최적화: 단계별 구현 계획

## 개발 단계 개요

프로젝트는 점진적으로 기능을 확장하는 3단계로 구성됩니다.

```
Phase 1 (MVP - 2개월) → Phase 2 (4개월) → Phase 3 (6개월)
         ↓                    ↓                  ↓
    핵심 기능 구현        사용자 경험 향상     고급 기능 추가
```

**핵심 원칙**:
- 라즈베리파이 성능 제약 고려 (메모리 < 2GB, CPU 최적화)
- 단일 Docker 컨테이너 배포
- 불필요한 기능 제거 (댓글, 플레이리스트, 실시간 알림 등)

---

## Phase 1: MVP (2개월 - 절대 필수)

**목표**: 라즈베리파이에서 안정적으로 동작하는 핵심 기능 구현
**기간**: 8주
**동시 접속 목표**: 3명

### 1.1 개발 환경 설정

#### 백엔드
- [ ] Python 3.11+ 설치
- [ ] PostgreSQL 14+ 설치 및 설정
- [ ] FFmpeg 설치
- [ ] FastAPI 프로젝트 구조 생성
- [ ] 가상환경 설정 및 필수 패키지 설치
  - FastAPI
  - SQLAlchemy
  - Alembic
  - python-jose (JWT)
  - passlib (비밀번호 해싱)
  - python-multipart (파일 업로드)
  - aiofiles (비동기 파일 처리)

#### 프론트엔드
- [ ] Node.js 18+ 설치
- [ ] React + Vite 프로젝트 생성
- [ ] TypeScript 설정
- [ ] Tailwind CSS 설정
- [ ] React Router 설정
- [ ] Axios 설정

#### 버전 관리
- [ ] Git 저장소 초기화
- [ ] .gitignore 설정
- [ ] README.md 작성

### 1.2 데이터베이스 설정

- [ ] PostgreSQL 데이터베이스 생성
- [ ] SQLAlchemy 모델 정의
  - User 모델
  - Video 모델
  - Category 모델
- [ ] Alembic 초기화
- [ ] 초기 마이그레이션 생성 및 적용
- [ ] 샘플 카테고리 데이터 시딩

### 1.3 백엔드 핵심 기능 구현

#### 인증 & 권한 시스템 ⭐
- [ ] JWT 토큰 생성/검증 유틸리티
- [ ] 비밀번호 해싱 (bcrypt)
- [ ] 회원가입 API (기본 역할: user)
- [ ] 로그인 API
- [ ] 토큰 갱신 API
- [ ] **Admin 미들웨어** (관리자 권한 확인)
- [ ] 인증 미들웨어

#### 사용자 관리
- [ ] 프로필 조회 API
- [ ] 프로필 수정 API
- [ ] 비밀번호 변경 API

#### 태그 시스템 ⭐ 최우선
- [ ] Tag 모델 및 VideoTag 관계 설정
- [ ] 태그 목록 조회 API (유형별 필터)
- [ ] 태그 생성 API (Admin 전용)
- [ ] 비디오에 태그 추가/제거 API (Admin 전용)
- [ ] **고급 조합 검색 API** (포함/제외 조건)
  - include_tags 파라미터 처리
  - exclude_tags 파라미터 처리
  - 복잡한 SQL 쿼리 최적화

#### 비디오 관리 (Admin 전용) ⭐
- [ ] **Admin 전용 비디오 업로드 API**
  - 파일 검증 (mp4, mkv, avi, mov)
  - 파일 저장 (/mnt/videos)
  - 메타데이터 추출 (FFmpeg - duration, resolution, codec)
  - **자동 썸네일 생성 (10-15개) - 장면 전환 감지 방식**
    - FFmpeg `select='gt(scene,0.3)'` 필터 사용
    - WebP 형식으로 저장 (320x180)
    - video_thumbnails 테이블에 저장
    - 첫 번째 썸네일 기본 선택
- [ ] 비디오 목록 조회 API (페이지네이션, 태그 포함)
- [ ] 비디오 상세 조회 API (태그, 썸네일 포함)
- [ ] 비디오 스트리밍 API (HTTP Range Requests, 206 Partial Content)
  - 직접 스트리밍 (트랜스코딩 최소화)
- [ ] **Admin 전용 비디오 수정 API**
- [ ] **Admin 전용 비디오 삭제 API**

#### 썸네일 관리 ⭐ 최우선
- [ ] 비디오 썸네일 목록 조회 API (공개)
- [ ] **Admin: 썸네일 선택 API**
  - 기존 선택 해제
  - 새 썸네일 선택
  - videos 테이블 thumbnail_path 업데이트
- [ ] **Admin: 외부 이미지 썸네일 업로드 API**
  - 이미지 파일 검증
  - 저장 및 DB 등록
  - is_auto_generated = false

#### 카테고리 관리
- [ ] 카테고리 목록 조회 API
- [ ] 카테고리별 비디오 필터링

### 1.4 프론트엔드 핵심 기능 구현

#### 레이아웃 & 공통 컴포넌트 (다크 모드, YouTube 스타일)
- [ ] Header 컴포넌트 (검색바, 사용자 메뉴)
- [ ] Footer 컴포넌트
- [ ] Loading 컴포넌트
- [ ] Modal 컴포넌트
- [ ] Button, Input 등 기본 UI 컴포넌트
- [ ] **다크 모드 (Netflix 스타일 색상 팔레트)**

#### 인증 페이지
- [ ] 로그인 페이지
- [ ] 회원가입 페이지
- [ ] 인증 상태 관리 (Zustand - 경량)
  - 사용자 정보 (role: user/admin/premium)
- [ ] Protected Route 구현
- [ ] **Admin Route 구현** (role === 'admin')

#### 비디오 페이지
- [ ] **홈 페이지 (YouTube 스타일 격자 레이아웃)** ⭐
  - **VideoCard 컴포넌트 (썸네일 중심)**
    - **호버 미리보기 기능**:
      - 마우스 오버 시 썸네일 자동 변경 (1초 간격)
      - 썸네일 프리로드 (Intersection Observer)
      - CSS transition (자연스러운 전환)
      - 이벤트 최적화 (debounce 300ms)
    - 그리드 레이아웃 (반응형: 모바일 1열, 태블릿 2-3열, 데스크톱 4-5열)
    - 비디오 제목, duration, 태그 표시
  - 페이지네이션 (초기 20개)
  - 카테고리 필터링
- [ ] 비디오 상세 페이지
  - VideoPlayer 컴포넌트 (Video.js)
  - HTTP Range Requests 지원
  - 비디오 정보 및 태그 표시
  - 관련 비디오 섹션 (같은 태그)

#### 검색 페이지 ⭐ 최우선
- [ ] **제목 키워드 검색 (1순위)**
  - 검색바 (Header에 통합)
  - Full-Text Search API 호출
  - Debouncing (300ms)
  - 검색 결과 그리드
- [ ] **태그 조합 검색 (2순위)**
  - 태그 목록 표시 (유형별 그룹화: 국가, 장르, 분위기)
  - **체크박스 + 연산자 선택 UI**:
    - 각 태그마다 체크박스
    - 연산자 선택: 포함 / 제외
    - 선택된 태그 요약 표시
  - 선택된 필터 요약 표시
  - 필터 초기화 버튼
- [ ] **고급 검색 결과 페이지**
  - API 호출 (include_tags, exclude_tags)
  - 검색 결과 그리드 (YouTube 스타일)
  - 적용된 필터 표시

#### Admin 전용 페이지 ⭐
- [ ] **비디오 업로드 페이지** (Admin 전용)
  - 파일 선택 UI
  - 업로드 진행률 표시
  - 메타데이터 입력 폼
  - **태그 선택 UI** (다중 선택)
- [ ] **썸네일 관리 페이지** (Admin 전용)
  - 자동 생성된 썸네일 목록 표시
  - 썸네일 선택 기능 (클릭 또는 라디오 버튼)
  - 외부 이미지 업로드
  - 선택된 썸네일 표시

#### 프로필 페이지
- [ ] 프로필 조회/수정
- [ ] 내가 업로드한 비디오 목록 (Admin인 경우)

### 1.5 통합 & 테스트

- [ ] API 통합 테스트
- [ ] 프론트엔드 E2E 테스트 (기본)
- [ ] 에러 처리 및 사용자 피드백
- [ ] CORS 설정
- [ ] 기본 보안 검증

### 1.6 배포 준비

- [ ] 환경 변수 설정 (.env)
- [ ] 프로덕션 설정 (DEBUG=False)
- [ ] 정적 파일 서빙 설정
- [ ] 로컬 테스트 및 검증

**예상 결과물**: 사용자가 회원가입/로그인하고, 비디오를 업로드하고, 스트리밍할 수 있는 기본 플랫폼

---

## Phase 2: 중급 기능 확장

**목표**: 사용자 경험 향상 및 상호작용 기능 추가

### 2.1 검색 기능

- [ ] 백엔드: 풀텍스트 검색 API
  - PostgreSQL `to_tsvector` 활용
  - 제목, 설명 검색
- [ ] 프론트엔드: 검색 페이지
  - 검색바 컴포넌트
  - 검색 결과 표시
  - Debouncing 적용

### 2.2 카테고리 확장

- [ ] 계층적 카테고리 지원
  - 백엔드: 부모-자식 관계 쿼리
  - 프론트엔드: 카테고리 네비게이션
- [ ] 카테고리 페이지
  - 카테고리별 비디오 목록
  - 서브카테고리 필터

### 2.3 시청 기록 & 이어보기

- [ ] 백엔드
  - 시청 기록 저장 API
  - 진행 상태 업데이트 API
  - 이어보기 목록 조회 API
- [ ] 프론트엔드
  - 비디오 플레이어에 진행 상태 저장 로직
  - 이어보기 섹션 표시
  - 진행률 표시 (프로그레스 바)

### 2.4 평점 시스템 ⭐

- [ ] 백엔드
  - ratings 테이블 및 마이그레이션
  - Rating 모델 정의
  - 평점 등록/수정 API
  - 평균 평점 계산
  - 비디오 목록/상세 조회에 평점 정보 포함
- [ ] 프론트엔드
  - 별점 UI 컴포넌트 (1-5점)
  - 비디오 상세 페이지 평점 섹션
  - 평균 평점 표시
  - 내 평점 등록/수정 UI

### 2.5 비디오 통계

- [ ] 백엔드
  - 시청 시간 추적 API
  - 인기 비디오 집계
  - 통계 조회 API
- [ ] 프론트엔드
  - 인기 비디오 섹션
  - 시청 통계 표시

### 2.6 사용자 프로필 확장

- [ ] 프로필 아바타 업로드
- [ ] 사용자 활동 통계
  - 업로드한 비디오 수
  - 총 조회수
  - 총 시청 시간

### 2.7 정렬 & 필터링

- [ ] 백엔드
  - 다양한 정렬 옵션 (최신순, 인기순, 평점순)
  - 복합 필터링
- [ ] 프론트엔드
  - 정렬 드롭다운
  - 필터 사이드바

### 2.8 무한 스크롤

- [ ] Intersection Observer 활용
- [ ] useInfiniteScroll 커스텀 훅
- [ ] 비디오 목록에 적용

### 2.9 성능 최적화

- [ ] 프론트엔드
  - 이미지 lazy loading
  - Code splitting (React.lazy)
  - 메모이제이션 (useMemo, useCallback)
- [ ] 백엔드
  - DB 쿼리 최적화 (인덱스 추가)
  - N+1 쿼리 문제 해결 (joinedload)
  - API 응답 캐싱 (Redis 선택적)

**예상 결과물**: 사용자가 비디오를 검색하고, 시청 기록을 관리하며, 향상된 정렬/필터 기능을 사용할 수 있는 완성도 높은 플랫폼

---

## Phase 3: 고급 기능 & 최적화

**목표**: 엔터프라이즈급 기능 및 AI 기반 추천 시스템

### 3.1 추천 시스템

- [ ] 백엔드
  - 사용자 행동 데이터 수집
    - 시청 기록
    - 찜 목록
    - 평점
  - 추천 알고리즘 구현
    - 협업 필터링 (Collaborative Filtering)
    - 콘텐츠 기반 필터링
    - 하이브리드 방식
  - 추천 API
- [ ] 프론트엔드
  - "당신을 위한 추천" 섹션
  - "비슷한 비디오" 섹션

### 3.2 다중 화질 지원

- [ ] 백엔드
  - FFmpeg를 통한 다중 화질 트랜스코딩
    - 360p, 480p, 720p, 1080p
  - HLS (HTTP Live Streaming) 지원
  - 화질별 파일 저장 및 관리
  - 화질 선택 API
- [ ] 프론트엔드
  - HLS.js 통합
  - 화질 선택 UI
  - 자동 화질 조정 (Adaptive Bitrate)

### 3.3 자막 지원

- [ ] 백엔드
  - 자막 파일 업로드 API (.srt, .vtt)
  - 다국어 자막 관리
  - 자막 목록 조회 API
- [ ] 프론트엔드
  - 자막 선택 UI
  - 비디오 플레이어 자막 표시

### 3.4 관리자 대시보드

- [ ] 백엔드
  - 관리자 권한 확인 미들웨어
  - 통계 API
    - 총 사용자 수
    - 총 비디오 수
    - 총 조회수
    - 스토리지 사용량
  - 사용자 관리 API
    - 사용자 목록 조회
    - 사용자 활성화/비활성화
  - 비디오 관리 API
    - 모든 비디오 조회
    - 비디오 승인/거부
    - 비디오 삭제
- [ ] 프론트엔드
  - 관리자 대시보드 페이지
  - 통계 차트 (Chart.js 또는 Recharts)
  - 사용자 관리 테이블
  - 비디오 관리 테이블

### 3.5 알림 시스템

- [ ] 백엔드
  - 알림 모델 및 API
  - 알림 유형
    - 비디오 처리 완료
    - 시스템 공지사항
  - WebSocket 지원 (선택적)
- [ ] 프론트엔드
  - 알림 벨 아이콘
  - 알림 드롭다운
  - 실시간 알림 (WebSocket)

### 3.6 비디오 공유 & 임베드

- [ ] 공유 버튼 (소셜 미디어)
- [ ] 임베드 코드 생성
- [ ] 임베드 플레이어 페이지

### 3.7 플레이리스트

- [ ] 백엔드
  - 플레이리스트 모델
  - 플레이리스트 CRUD API
  - 플레이리스트에 비디오 추가/제거
- [ ] 프론트엔드
  - 플레이리스트 생성/관리 UI
  - 플레이리스트 재생 기능

### 3.8 고급 분석

- [ ] 백엔드
  - 시청 시간 추적
  - 사용자 세그먼트 분석
  - 인기 키워드 분석
- [ ] 프론트엔드
  - 크리에이터용 분석 대시보드
    - 조회수 추이
    - 시청 시간
    - 인구통계

### 3.9 보안 강화

- [ ] Rate Limiting (slowapi)
- [ ] CSRF 보호
- [ ] XSS 방지
- [ ] SQL Injection 방지 (ORM 사용으로 기본 방어)
- [ ] 파일 업로드 보안
  - MIME type 검증
  - 파일 스캔 (ClamAV 선택적)
- [ ] HTTPS 강제 (프로덕션)

### 3.10 성능 & 확장성

- [ ] Redis 캐싱
  - API 응답 캐싱
  - 세션 저장소
  - 조회수 카운터
- [ ] CDN 통합 (선택적)
  - 정적 파일 (썸네일, 비디오)
- [ ] 데이터베이스 최적화
  - 복합 인덱스
  - 쿼리 튜닝
  - 커넥션 풀링
- [ ] 비동기 작업 큐 (Celery + Redis 선택적)
  - 비디오 트랜스코딩
  - 썸네일 생성
  - 이메일 발송

### 3.11 배포 & 인프라

- [ ] Docker 컨테이너화
  - Dockerfile (백엔드, 프론트엔드)
  - docker-compose.yml
- [ ] CI/CD 파이프라인
  - GitHub Actions
  - 자동 테스트
  - 자동 배포
- [ ] 클라우드 배포 (선택적)
  - AWS / GCP / Azure
  - S3/GCS: 비디오 스토리지
  - CloudFront/CDN: 콘텐츠 전송
- [ ] 모니터링 & 로깅
  - Prometheus + Grafana (메트릭)
  - Sentry (에러 트래킹)
  - ELK Stack (로그 수집/분석, 선택적)

**예상 결과물**: Netflix와 유사한 수준의 기능을 갖춘 완전한 스트리밍 플랫폼

---

## 개발 우선순위

### Critical Priority (최우선 핵심 기능) ⭐
1. **태그 시스템 및 고급 조합 검색**
   - 태그 모델 및 관계 설정
   - 포함(+)/제외(-) 조건 검색 로직
   - 태그 선택 UI (클릭으로 포함/제외/해제 전환)
   - **사용자 요구사항**: 매우 높음

2. **썸네일 자동 생성 및 관리**
   - FFmpeg를 통한 자동 썸네일 생성 (5-10개)
   - 관리자 썸네일 선택 기능
   - 외부 이미지 썸네일 업로드
   - **사용자 요구사항**: 매우 높음

3. **썸네일 호버 미리보기**
   - 마우스 오버 시 여러 썸네일 순차 표시
   - 썸네일 프리로드 및 최적화
   - **사용자 요구사항**: 매우 높음

### High Priority (반드시 구현)
1. **Admin 전용 비디오 등록**
   - 역할 기반 권한 시스템 (user, admin)
   - Admin 미들웨어
   - Admin 전용 라우팅
   - **사용자 요구사항**: 높음

2. 인증 시스템
   - JWT 기반 로그인/회원가입
   - 토큰 갱신

3. 비디오 업로드/스트리밍
   - 비디오 메타데이터 추출
   - Range 요청 지원 스트리밍

4. 기본 UI/UX
   - Netflix 스타일 레이아웃
   - 비디오 카드, 플레이어

### Medium Priority (중요)
1. 카테고리 시스템
2. 시청 기록 & 이어보기
3. 비디오 통계
4. 검색 결과 정렬/필터
5. 사용자 프로필 확장

### Low Priority (선택적)
1. 추천 시스템
2. 다중 화질 (HLS)
3. 관리자 대시보드 통계
4. 플레이리스트
5. Docker 배포 최적화

---

## 마일스톤

### Milestone 1: MVP 완성
- 기본 인증, 비디오 CRUD, 스트리밍 기능
- 간단한 UI

### Milestone 2: 베타 버전
- 평점 시스템 (별점 1-5)
- Full-Text Search, 시청 기록, 이어보기
- 비디오 통계 및 분석
- 개선된 UI/UX
- 성능 최적화

### Milestone 3: 프로덕션 준비
- 추천 시스템
- 다중 화질
- 관리자 대시보드
- 보안 강화
- 배포 및 모니터링

---

## 기술 부채 관리

### 코드 품질
- 정기적인 코드 리뷰
- Linting 및 포매팅 자동화
- 테스트 커버리지 목표: 80%+

### 문서화
- API 문서 최신화 (Swagger 자동 생성)
- 코드 주석 (복잡한 로직만)
- README 및 설치 가이드

### 리팩토링
- 중복 코드 제거
- 복잡한 함수 분리
- 성능 병목 개선

---

## 위험 요소 & 대응 전략

### 위험 요소
1. **파일 저장 공간 부족**
   - 대응: 스토리지 모니터링, 오래된 파일 정리 정책
2. **동시 업로드 과부하**
   - 대응: Rate Limiting, 큐 시스템 도입
3. **비디오 처리 시간 지연**
   - 대응: 백그라운드 작업, 진행 상태 표시
4. **보안 취약점**
   - 대응: 정기적인 보안 점검, 업데이트

### 대응 전략
- 점진적 개발 및 테스트
- 사용자 피드백 수집
- 성능 모니터링
- 정기적인 백업

---

## 다음 단계

Phase 1 MVP 개발을 시작할 준비가 되었습니다:

1. ✅ 프로젝트 문서 완료
2. ⏭️ 개발 환경 설정
3. ⏭️ 백엔드 기본 구조 생성
4. ⏭️ 데이터베이스 모델 구현
5. ⏭️ 인증 시스템 구현
