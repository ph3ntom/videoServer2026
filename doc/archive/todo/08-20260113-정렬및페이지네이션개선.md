# ì •ë ¬ & í˜ì´ì§€ë„¤ì´ì…˜ ê°œì„  (Phase 2.7)

**ë‚ ì§œ**: 2026-01-13
**ìƒíƒœ**: â³ ëŒ€ê¸° ì¤‘ (ìˆœì„œëŒ€ë¡œ ì§„í–‰)
**Phase**: Phase 2.7 (ì •ë ¬ & í•„í„°ë§)
**ìš°ì„ ìˆœìœ„**: Medium

---

## ğŸ“‹ ì‚¬ìš©ì ìš”ì²­ì‚¬í•­

### ì¸ê¸° ë¹„ë””ì˜¤ ì„¹ì…˜
- **í˜„ì¬**: 8ê°œ í‘œì‹œ (ê°€ë¡œ 4ê°œ x ì„¸ë¡œ 2ê°œ)
- **ìš”ì²­**: 20ê°œ í‘œì‹œ (ê°€ë¡œ 4ê°œ x ì„¸ë¡œ 5ê°œ)
- **ì •ë ¬**: ì¡°íšŒìˆ˜ ê¸°ì¤€ (í˜„ì¬ ë™ì¼)

### ë†’ì€ í‰ì  ì„¹ì…˜
- **í˜„ì¬**: 8ê°œ í‘œì‹œ (ê°€ë¡œ 4ê°œ x ì„¸ë¡œ 2ê°œ)
- **ìš”ì²­**: 20ê°œ í‘œì‹œ (ê°€ë¡œ 4ê°œ x ì„¸ë¡œ 5ê°œ)
- **ì •ë ¬**: í‰ê·  í‰ì  ê¸°ì¤€ (í˜„ì¬ ë™ì¼)

### ì „ì²´ ë¹„ë””ì˜¤ ì„¹ì…˜
- **í˜„ì¬**: ëª¨ë“  ë¹„ë””ì˜¤ ë¬´ì œí•œ í‘œì‹œ, ì •ë ¬ ì—†ìŒ
- **ìš”ì²­**:
  - í˜ì´ì§€ë„¤ì´ì…˜: í•œ í˜ì´ì§€ë‹¹ 20ê°œ
  - ì •ë ¬ ì˜µì…˜: ì¡°íšŒìˆ˜ìˆœ, ë³„ì ìˆœ, ìµœì‹ ìˆœ

---

## ğŸ¯ êµ¬í˜„ ê³„íš

### ë°±ì—”ë“œ ìˆ˜ì •

#### 1. ë¹„ë””ì˜¤ ëª©ë¡ API ê°œì„  (`backend/app/api/v1/videos.py`)

**í˜„ì¬**:
```python
@router.get("/", response_model=List[VideoListResponse])
async def list_videos(
    skip: int = 0,
    limit: int = 100,
    tag_ids: Optional[str] = None,
    db: AsyncSession = Depends(get_db)
):
```

**ë³€ê²½**:
```python
@router.get("/", response_model=List[VideoListResponse])
async def list_videos(
    skip: int = Query(0, ge=0, description="Pagination offset"),
    limit: int = Query(20, ge=1, le=100, description="Items per page"),
    tag_ids: Optional[str] = Query(None, description="Comma-separated tag IDs"),
    sort_by: str = Query("created_at", regex="^(created_at|view_count|rating)$", description="Sort field"),
    order: str = Query("desc", regex="^(asc|desc)$", description="Sort order"),
    db: AsyncSession = Depends(get_db)
):
```

**ì •ë ¬ ë¡œì§**:
- `sort_by=created_at`: ìµœì‹ ìˆœ
- `sort_by=view_count`: ì¡°íšŒìˆ˜ìˆœ
- `sort_by=rating`: í‰ì ìˆœ (í‰ê·  í‰ì  ê³„ì‚° í•„ìš”)
- `order=desc`: ë‚´ë¦¼ì°¨ìˆœ (ê¸°ë³¸ê°’)
- `order=asc`: ì˜¤ë¦„ì°¨ìˆœ

#### 2. ë¹„ë””ì˜¤ ì„œë¹„ìŠ¤ ì •ë ¬ ë¡œì§ ì¶”ê°€ (`backend/app/services/video_service.py`)

```python
@staticmethod
async def get_videos_with_sorting(
    db: AsyncSession,
    skip: int = 0,
    limit: int = 20,
    tag_ids: List[int] = None,
    sort_by: str = "created_at",
    order: str = "desc"
) -> List[Video]:
    """
    Get videos with sorting

    Args:
        sort_by: created_at, view_count, rating
        order: asc, desc
    """
    query = select(Video).where(Video.status == "ready")

    # Apply tag filtering if needed
    if tag_ids:
        # ... existing tag filter logic

    # Apply sorting
    if sort_by == "rating":
        # Join with ratings table and calculate avg
        rating_subquery = (
            select(
                Rating.video_id,
                func.avg(Rating.score).label('avg_rating')
            )
            .group_by(Rating.video_id)
            .subquery()
        )

        query = query.outerjoin(
            rating_subquery,
            Video.id == rating_subquery.c.video_id
        )

        sort_column = rating_subquery.c.avg_rating
    elif sort_by == "view_count":
        sort_column = Video.view_count
    else:  # created_at
        sort_column = Video.created_at

    # Apply order
    if order == "asc":
        query = query.order_by(asc(sort_column))
    else:
        query = query.order_by(desc(sort_column))

    query = query.offset(skip).limit(limit)

    result = await db.execute(query)
    return result.scalars().all()
```

#### 3. í†µê³„ API limit ì¦ê°€

**íŒŒì¼**: `backend/app/api/v1/statistics.py`

```python
# í˜„ì¬
@router.get("/popular", response_model=List[VideoListResponse])
async def get_popular_videos(
    limit: int = Query(default=10, ge=1, le=50, ...),
    ...
):

# ë³€ê²½
@router.get("/popular", response_model=List[VideoListResponse])
async def get_popular_videos(
    limit: int = Query(default=20, ge=1, le=100, ...),  # 50 -> 100
    ...
):

# top-ratedë„ ë™ì¼í•˜ê²Œ ìˆ˜ì •
```

---

### í”„ë¡ íŠ¸ì—”ë“œ ìˆ˜ì •

#### 1. Videos í˜ì´ì§€ ë ˆì´ì•„ì›ƒ ìˆ˜ì • (`frontend/src/pages/Videos.tsx`)

**ì¸ê¸° ë¹„ë””ì˜¤ & ë†’ì€ í‰ì  ì„¹ì…˜**:
```typescript
// í˜„ì¬
loadPopularVideos = async () => {
  const response = await apiClient.get('/statistics/popular?limit=8');
  setPopularVideos(response.data);
};

loadTopRatedVideos = async () => {
  const response = await apiClient.get('/statistics/top-rated?limit=8&min_ratings=3');
  setTopRatedVideos(response.data);
};

// ë³€ê²½
loadPopularVideos = async () => {
  const response = await apiClient.get('/statistics/popular?limit=20');
  setPopularVideos(response.data);
};

loadTopRatedVideos = async () => {
  const response = await apiClient.get('/statistics/top-rated?limit=20&min_ratings=3');
  setTopRatedVideos(response.data);
};
```

#### 2. ì „ì²´ ë¹„ë””ì˜¤ ì„¹ì…˜ - ì •ë ¬ ë“œë¡­ë‹¤ìš´ ì¶”ê°€

**State ì¶”ê°€**:
```typescript
const [sortBy, setSortBy] = useState<'created_at' | 'view_count' | 'rating'>('created_at');
const [page, setPage] = useState(1);
const [totalPages, setTotalPages] = useState(1);
const ITEMS_PER_PAGE = 20;
```

**ì •ë ¬ ë“œë¡­ë‹¤ìš´ UI**:
```tsx
{/* Sorting Dropdown */}
<div className="flex items-center gap-2 mb-6">
  <label className="text-sm text-gray-400">ì •ë ¬:</label>
  <select
    value={sortBy}
    onChange={(e) => setSortBy(e.target.value as any)}
    className="bg-gray-800 text-white px-4 py-2 rounded-md border border-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500"
  >
    <option value="created_at">ìµœì‹ ìˆœ</option>
    <option value="view_count">ì¡°íšŒìˆ˜ìˆœ</option>
    <option value="rating">í‰ì ìˆœ</option>
  </select>
</div>
```

**API í˜¸ì¶œ ìˆ˜ì •**:
```typescript
const loadVideos = async () => {
  setLoading(true);
  setError('');

  try {
    const params = new URLSearchParams();

    if (selectedTag) {
      params.append('tag_ids', selectedTag.toString());
    }

    params.append('skip', ((page - 1) * ITEMS_PER_PAGE).toString());
    params.append('limit', ITEMS_PER_PAGE.toString());
    params.append('sort_by', sortBy);
    params.append('order', 'desc');

    const response = await apiClient.get(`/videos/?${params.toString()}`);
    setVideos(response.data);

    // Calculate total pages (need total count from API)
    // setTotalPages(Math.ceil(response.data.total / ITEMS_PER_PAGE));
  } catch (err: any) {
    setError('ë¹„ë””ì˜¤ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
  } finally {
    setLoading(false);
  }
};

// Reload when sortBy or page changes
useEffect(() => {
  loadVideos();
}, [selectedTag, sortBy, page]);
```

#### 3. í˜ì´ì§€ë„¤ì´ì…˜ ì»´í¬ë„ŒíŠ¸

```tsx
{/* Pagination */}
{totalPages > 1 && (
  <div className="flex justify-center items-center gap-2 mt-8">
    <button
      onClick={() => setPage(p => Math.max(1, p - 1))}
      disabled={page === 1}
      className="px-4 py-2 bg-gray-800 text-white rounded-md disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-700"
    >
      ì´ì „
    </button>

    <span className="text-gray-300">
      {page} / {totalPages}
    </span>

    <button
      onClick={() => setPage(p => Math.min(totalPages, p + 1))}
      disabled={page === totalPages}
      className="px-4 py-2 bg-gray-800 text-white rounded-md disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-700"
    >
      ë‹¤ìŒ
    </button>
  </div>
)}
```

---

## ğŸ”„ Total Count API ì¶”ê°€ (ì„ íƒì )

í˜ì´ì§€ë„¤ì´ì…˜ì„ ìœ„í•´ ì „ì²´ ë¹„ë””ì˜¤ ê°œìˆ˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.

### Option 1: Responseì— total í¬í•¨

```python
class VideoListResponseWithTotal(BaseModel):
    items: List[VideoListResponse]
    total: int
    page: int
    limit: int
```

### Option 2: ë³„ë„ count API

```python
@router.get("/count")
async def get_video_count(
    tag_ids: Optional[str] = None,
    db: AsyncSession = Depends(get_db)
):
    query = select(func.count(Video.id)).where(Video.status == "ready")
    # Apply filters...
    result = await db.execute(query)
    return {"count": result.scalar()}
```

---

## ğŸ“Š ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ í™•ì¸

**í˜„ì¬ ê·¸ë¦¬ë“œ ì„¤ì •** (Videos.tsx):
```tsx
<div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
```

- **ëª¨ë°”ì¼**: 1ì—´
- **íƒœë¸”ë¦¿ (md)**: 2ì—´
- **ë°ìŠ¤í¬í†± (lg)**: 3ì—´
- **ëŒ€í˜• í™”ë©´ (xl)**: 4ì—´ âœ…

**20ê°œ í‘œì‹œ ì‹œ**:
- 4ì—´ x 5í–‰ = 20ê°œ (xl í™”ë©´)
- 3ì—´ x 7í–‰ (lg í™”ë©´)
- 2ì—´ x 10í–‰ (md í™”ë©´)

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ë°±ì—”ë“œ
- [ ] `GET /api/v1/videos/?sort_by=view_count&order=desc&limit=20` í…ŒìŠ¤íŠ¸
- [ ] `GET /api/v1/videos/?sort_by=rating&order=desc&limit=20` í…ŒìŠ¤íŠ¸
- [ ] `GET /api/v1/videos/?sort_by=created_at&order=desc&limit=20` í…ŒìŠ¤íŠ¸
- [ ] íƒœê·¸ í•„í„°ì™€ ì •ë ¬ ë™ì‹œ ì ìš© í…ŒìŠ¤íŠ¸
- [ ] í˜ì´ì§€ë„¤ì´ì…˜ í…ŒìŠ¤íŠ¸ (skip=0, skip=20, skip=40)

### í”„ë¡ íŠ¸ì—”ë“œ
- [ ] ì¸ê¸° ë¹„ë””ì˜¤ 20ê°œ í‘œì‹œ í™•ì¸
- [ ] ë†’ì€ í‰ì  20ê°œ í‘œì‹œ í™•ì¸
- [ ] ì •ë ¬ ë“œë¡­ë‹¤ìš´ ë™ì‘ í™•ì¸
- [ ] í˜ì´ì§€ë„¤ì´ì…˜ ë²„íŠ¼ ë™ì‘ í™•ì¸
- [ ] ë°˜ì‘í˜• ë ˆì´ì•„ì›ƒ í™•ì¸ (ëª¨ë°”ì¼, íƒœë¸”ë¦¿, ë°ìŠ¤í¬í†±)

---

## ğŸ“ êµ¬í˜„ ìˆœì„œ

1. **ë°±ì—”ë“œ ì •ë ¬ ë¡œì§ ì¶”ê°€**
   - video_service.py ìˆ˜ì •
   - videos.py API ìˆ˜ì •
   - statistics.py limit ì¦ê°€

2. **í”„ë¡ íŠ¸ì—”ë“œ UI ìˆ˜ì •**
   - limit 8 â†’ 20 ë³€ê²½
   - ì •ë ¬ ë“œë¡­ë‹¤ìš´ ì¶”ê°€
   - í˜ì´ì§€ë„¤ì´ì…˜ UI ì¶”ê°€

3. **í…ŒìŠ¤íŠ¸**
   - API í…ŒìŠ¤íŠ¸
   - ë¸Œë¼ìš°ì € í…ŒìŠ¤íŠ¸
   - ë°˜ì‘í˜• í…ŒìŠ¤íŠ¸

4. **ë¬¸ì„œ ì—…ë°ì´íŠ¸**
   - API ëª…ì„¸ì„œ ì—…ë°ì´íŠ¸
   - ê°œë°œ ê³¼ì • ë¬¸ì„œ ì‘ì„±

---

## ğŸ”— ê´€ë ¨ íŒŒì¼

### ë°±ì—”ë“œ
- `backend/app/api/v1/videos.py` - ë¹„ë””ì˜¤ ëª©ë¡ API
- `backend/app/api/v1/statistics.py` - í†µê³„ API
- `backend/app/services/video_service.py` - ë¹„ë””ì˜¤ ì„œë¹„ìŠ¤

### í”„ë¡ íŠ¸ì—”ë“œ
- `frontend/src/pages/Videos.tsx` - ë©”ì¸ ë¹„ë””ì˜¤ í˜ì´ì§€
- `frontend/src/components/video/VideoCard.tsx` - ë¹„ë””ì˜¤ ì¹´ë“œ ì»´í¬ë„ŒíŠ¸

---

## ğŸ“… ì˜ˆìƒ ì‘ì—… ì‹œê°„

- ë°±ì—”ë“œ ìˆ˜ì •: 1-2ì‹œê°„
- í”„ë¡ íŠ¸ì—”ë“œ ìˆ˜ì •: 1-2ì‹œê°„
- í…ŒìŠ¤íŠ¸ & ë””ë²„ê¹…: 1ì‹œê°„
- **ì´ ì˜ˆìƒ ì‹œê°„**: 3-5ì‹œê°„

---

**ì‘ì„±ì¼**: 2026-01-13
**ì‘ì„±ì**: Claude Sonnet 4.5
**ìƒíƒœ**: â³ Phase 2.7ì—ì„œ ì§„í–‰ ì˜ˆì •
