# Todo: v0.6 - 비디오 검색 시스템

**작성일:** 2026-01-12
**상태:** ✅ 완료
**관련 명세:** [7.v0.6-search-system.md](../dev_Process/7.v0.6-search-system.md)

---

## 작업 개요

06_개발_로드맵.md의 Phase 1 검색 페이지 요구사항에 따라 비디오 검색 기능을 구현합니다.

---

## 체크리스트

### 백엔드

- [x] **검색 서비스 구현** (`video_service.py`)
  - [x] `search` 메서드 추가
  - [x] 키워드 검색 (제목, 설명, 업로더) - ILIKE
  - [x] `include_tags` 파라미터 처리 (OR 조건)
  - [x] `exclude_tags` 파라미터 처리 (NOT EXISTS)
  - [x] 정렬 옵션 (created_at, view_count, title)
  - [x] 페이지네이션 (skip, limit)

- [x] **검색 API 엔드포인트** (`videos.py`)
  - [x] `GET /api/v1/videos/search` 라우트 추가
  - [x] Query 파라미터 검증
    - [x] `q` (required, min_length=1)
    - [x] `skip`, `limit` (pagination)
    - [x] `sort_by` (regex 검증)
    - [x] `include_tags`, `exclude_tags` (쉼표 구분 파싱)
  - [x] 에러 처리 (400 Bad Request)
  - [x] API 문서 작성 (docstring)

- [x] **테스트**
  - [x] 기본 검색 테스트
  - [x] include_tags 테스트
  - [x] exclude_tags 테스트
  - [x] 정렬 옵션 테스트
  - [x] 조합 검색 테스트

### 프론트엔드

- [x] **SearchBar 컴포넌트** (`components/search/SearchBar.tsx`)
  - [x] 컴포넌트 파일 생성
  - [x] Debouncing (300ms) 구현
  - [x] Enter 키 즉시 검색
  - [x] URL 쿼리 파라미터 동기화
  - [x] 검색 아이콘 버튼
  - [x] timeout cleanup (useEffect)

- [x] **SearchPage 컴포넌트** (`pages/SearchPage.tsx`)
  - [x] 페이지 파일 생성
  - [x] URL 파라미터 파싱 (`useSearchParams`)
  - [x] 검색 API 호출
  - [x] 로딩 상태 표시
  - [x] 에러 처리
  - [x] 빈 결과 메시지
  - [x] 비디오 그리드 표시 (VideoCard 재사용)

- [x] **정렬 옵션 UI**
  - [x] 사이드바 레이아웃
  - [x] 정렬 버튼 (최신순, 인기순, 제목순)
  - [x] 선택된 정렬 하이라이트
  - [x] URL 업데이트

- [x] **태그 필터 UI**
  - [x] 태그 목록 로드 (`/tags/popular`)
  - [x] 포함 버튼 (클릭 토글)
  - [x] 제외 버튼 (−)
  - [x] 태그 상태 표시 (include: 녹색, exclude: 빨간색)
  - [x] 적용된 필터 요약 섹션
  - [x] 필터 초기화 버튼

- [x] **Layout 통합** (`components/common/Layout.tsx`)
  - [x] SearchBar import
  - [x] Header에 SearchBar 배치
  - [x] 로그인 사용자만 표시 조건

- [x] **라우팅 설정** (`App.tsx`)
  - [x] SearchPage import
  - [x] `/search` 라우트 추가
  - [x] PrivateRoute로 보호

### 문서화

- [x] **개발 명세 문서** (`doc/dev_Process/7.v0.6-search-system.md`)
  - [x] 개요 및 목적
  - [x] 백엔드 API 명세
  - [x] 프론트엔드 컴포넌트 설명
  - [x] 주요 기능 설명
  - [x] 테스트 가이드
  - [x] 향후 개선사항

- [x] **Todo 문서** (`doc/todo/03-20260112-검색시스템.md`)
  - [x] 작업 체크리스트

---

## 구현 세부사항

### 백엔드 변경사항

**파일:** `backend/app/services/video_service.py`

```python
# 새 메서드 추가
@staticmethod
async def search(
    db: AsyncSession,
    query_text: str,
    skip: int = 0,
    limit: int = 20,
    sort_by: str = "created_at",
    include_tags: Optional[List[int]] = None,
    exclude_tags: Optional[List[int]] = None,
    status: Optional[VideoStatus] = VideoStatus.READY
) -> List[Video]
```

**파일:** `backend/app/api/v1/videos.py`

```python
# 새 엔드포인트 추가
@router.get("/search", response_model=List[VideoListResponse])
async def search_videos(
    q: str = Query(..., min_length=1),
    skip: int = Query(0, ge=0),
    limit: int = Query(20, ge=1, le=100),
    sort_by: str = Query("created_at", regex="^(created_at|view_count|title)$"),
    include_tags: Optional[str] = Query(None),
    exclude_tags: Optional[str] = Query(None),
    db: AsyncSession = Depends(get_db)
)
```

### 프론트엔드 새 파일

1. `frontend/src/components/search/SearchBar.tsx` - 검색바 컴포넌트
2. `frontend/src/pages/SearchPage.tsx` - 검색 결과 페이지

### 프론트엔드 수정 파일

1. `frontend/src/components/common/Layout.tsx` - SearchBar 통합
2. `frontend/src/App.tsx` - 라우트 추가

---

## 테스트 결과

### 백엔드 API 테스트

```bash
# ✅ 기본 검색
curl "http://localhost:8000/api/v1/videos/search?q=test"
# 결과: 2개 (video ID: 8, 9)

# ✅ include_tags
curl "http://localhost:8000/api/v1/videos/search?q=test&include_tags=1,2"
# 결과: 태그 1 또는 2를 가진 비디오만 표시

# ✅ exclude_tags
curl "http://localhost:8000/api/v1/videos/search?q=test&exclude_tags=1"
# 결과: 태그 1을 가지지 않은 비디오만 표시

# ✅ 조합
curl "http://localhost:8000/api/v1/videos/search?q=test&include_tags=1&exclude_tags=2"
# 결과: 태그 1을 가지고 태그 2는 없는 비디오
```

---

## 완료 후 확인사항

- [x] 백엔드 서버 정상 작동 확인
- [x] API 엔드포인트 응답 확인
- [ ] 프론트엔드 개발 서버 실행 및 UI 확인
- [ ] 검색바 debouncing 동작 확인
- [ ] 태그 필터 UI 동작 확인
- [ ] 정렬 옵션 동작 확인

---

## 다음 단계

프론트엔드 개발 서버를 실행하여 UI를 테스트합니다:

```bash
cd frontend
npm run dev
```

**테스트 시나리오:**
1. 헤더 검색바에 검색어 입력
2. 검색 결과 페이지로 이동 확인
3. 정렬 옵션 변경
4. 태그 필터 (포함/제외) 동작 확인
5. 필터 초기화 버튼 동작 확인

---

## 향후 개선 계획 (Phase 2)

- [ ] PostgreSQL Full-Text Search (to_tsvector)
- [ ] 자동완성 기능
- [ ] 검색 기록
- [ ] 고급 필터 (날짜, 조회수 범위 등)
- [ ] 무한 스크롤

---

## 참고

- [06_개발_로드맵.md](../06_개발_로드맵.md) - Phase 1 검색 페이지 명세
- [7.v0.6-search-system.md](../dev_Process/7.v0.6-search-system.md) - 개발 명세
