# ì „ì²´ ì‹œìŠ¤í…œ í”Œë¡œìš° ë‹¤ì´ì–´ê·¸ë¨

## ğŸ“‹ ëª©ì°¨
1. [ì‚¬ìš©ì ì—¬ì • í”Œë¡œìš°](#ì‚¬ìš©ì-ì—¬ì •-í”Œë¡œìš°)
2. [ë°ì´í„° íë¦„ë„](#ë°ì´í„°-íë¦„ë„)
3. [ì‹œìŠ¤í…œ ìƒíƒœ ë‹¤ì´ì–´ê·¸ë¨](#ì‹œìŠ¤í…œ-ìƒíƒœ-ë‹¤ì´ì–´ê·¸ë¨)
4. [ì»´í¬ë„ŒíŠ¸ ê´€ê³„ë„](#ì»´í¬ë„ŒíŠ¸-ê´€ê³„ë„)
5. [ë°°í¬ ì•„í‚¤í…ì²˜](#ë°°í¬-ì•„í‚¤í…ì²˜)

---

## ì‚¬ìš©ì ì—¬ì • í”Œë¡œìš°

### ì „ì²´ ì‚¬ìš©ì ì—¬ì •

```mermaid
graph TB
    Start([ì‚¬ìš©ì ë°©ë¬¸]) --> A{ë¡œê·¸ì¸ ìƒíƒœ?}

    A -->|No| B[íšŒì›ê°€ì… í˜ì´ì§€]
    B --> C[ì´ë©”ì¼ ì…ë ¥]
    C --> D[ì¸ì¦ ì½”ë“œ ìˆ˜ì‹ ]
    D --> E[ì´ë©”ì¼ ì¸ì¦]
    E --> F[ë¡œê·¸ì¸]

    A -->|Yes| G[í™ˆ/ë¹„ë””ì˜¤ ëª©ë¡]
    F --> G

    G --> H{ì›í•˜ëŠ” ë™ì‘?}

    H -->|ë¹„ë””ì˜¤ ì‹œì²­| I[ë¹„ë””ì˜¤ ìƒì„¸ í˜ì´ì§€]
    I --> J[Video.js í”Œë ˆì´ì–´]
    J --> K[ì¡°íšŒìˆ˜ ì¦ê°€]

    H -->|ë¹„ë””ì˜¤ ì—…ë¡œë“œ| L[ì—…ë¡œë“œ í˜ì´ì§€]
    L --> M[íŒŒì¼ ì„ íƒ]
    M --> N[ë©”íƒ€ë°ì´í„° ì…ë ¥]
    N --> O[ì—…ë¡œë“œ ì‹œì‘]
    O --> P[FFmpeg ì²˜ë¦¬]
    P --> Q[ì¸ë„¤ì¼ ìƒì„± 12ê°œ]
    Q --> R[ì—…ë¡œë“œ ì™„ë£Œ]

    H -->|ë‘˜ëŸ¬ë³´ê¸°| S[ë¹„ë””ì˜¤ ì¹´ë“œ í˜¸ë²„]
    S --> T[300ms ëŒ€ê¸°]
    T --> U[ì¸ë„¤ì¼ ìˆœí™˜ í‘œì‹œ]
    U --> V{í´ë¦­?}
    V -->|Yes| I
    V -->|No| G

    K --> End([ì„¸ì…˜ ì¢…ë£Œ])
    R --> End
```

---

## ë°ì´í„° íë¦„ë„

### ë¹„ë””ì˜¤ ì—…ë¡œë“œ ë° ì¬ìƒ ë°ì´í„° íë¦„

```mermaid
flowchart TB
    subgraph "Client Side"
        A[ì‚¬ìš©ì ë¸Œë¼ìš°ì €]
        B[React App]
        C[Video.js Player]
    end

    subgraph "API Gateway"
        D[FastAPI Router]
        E[Auth Middleware]
    end

    subgraph "Application Layer"
        F[Video Service]
        G[Thumbnail Service]
        H[Auth Service]
    end

    subgraph "Processing"
        I[FFmpeg]
        J[FFprobe]
    end

    subgraph "Data Layer"
        K[(PostgreSQL)]
        L[File System]
    end

    subgraph "External"
        M[SMTP Server]
    end

    A -->|1. Upload Request| B
    B -->|2. Multipart Data| D
    D -->|3. Verify Token| E
    E -->|4. Process Upload| F
    F -->|5. Save File| L
    F -->|6. Extract Metadata| J
    J -->|7. Metadata| F
    F -->|8. Generate Thumbnails| G
    G -->|9. Process Video| I
    I -->|10. Thumbnail Files| L
    G -->|11. Save Records| K
    F -->|12. Update Video| K
    K -->|13. Video Info| F
    F -->|14. Response| D
    D -->|15. Video Data| B
    B -->|16. Success| A

    style A fill:#60a5fa
    style K fill:#34d399
    style L fill:#fbbf24
    style I fill:#f87171
```

### ì¸ì¦ ë°ì´í„° íë¦„

```mermaid
flowchart LR
    subgraph "User Actions"
        A[Register]
        B[Verify Email]
        C[Login]
    end

    subgraph "API Processing"
        D[Auth Router]
        E[Auth Service]
        F[Email Service]
        G[JWT Manager]
    end

    subgraph "Data Storage"
        H[(users)]
        I[(email_verifications)]
    end

    subgraph "External"
        J[SMTP]
        K[User Email]
    end

    A -->|1. User Data| D
    D -->|2. Create User| E
    E -->|3. Hash Password| E
    E -->|4. Save| H
    E -->|5. Generate Code| F
    F -->|6. Save Code| I
    F -->|7. Send Email| J
    J -->|8. Deliver| K

    B -->|9. Verify Code| D
    D -->|10. Check Code| E
    E -->|11. Query| I
    I -->|12. Valid?| E
    E -->|13. Update User| H

    C -->|14. Credentials| D
    D -->|15. Authenticate| E
    E -->|16. Query| H
    H -->|17. User Data| E
    E -->|18. Generate Tokens| G
    G -->|19. JWT Tokens| D
    D -->|20. Return| C
```

---

## ì‹œìŠ¤í…œ ìƒíƒœ ë‹¤ì´ì–´ê·¸ë¨

### ë¹„ë””ì˜¤ ìƒíƒœ ì „ì´

```mermaid
stateDiagram-v2
    [*] --> Uploading: ì‚¬ìš©ìê°€ íŒŒì¼ ì„ íƒ

    Uploading --> Validating: íŒŒì¼ ì „ì†¡ ì™„ë£Œ

    Validating --> Rejected: íŒŒì¼ í˜•ì‹/í¬ê¸° ì˜¤ë¥˜
    Validating --> Processing: ê²€ì¦ ì„±ê³µ

    Processing --> ExtractingMetadata: íŒŒì¼ ì €ì¥ ì™„ë£Œ

    ExtractingMetadata --> GeneratingThumbnails: ë©”íƒ€ë°ì´í„° ì¶”ì¶œ ì„±ê³µ
    ExtractingMetadata --> Error: FFprobe ì‹¤íŒ¨

    GeneratingThumbnails --> Ready: ì¸ë„¤ì¼ ìƒì„± ì„±ê³µ
    GeneratingThumbnails --> Error: FFmpeg ì‹¤íŒ¨

    Ready --> Streaming: ì‚¬ìš©ì ì¬ìƒ ìš”ì²­
    Streaming --> Ready: ì¬ìƒ ì™„ë£Œ

    Ready --> Updating: ì‚¬ìš©ì ìˆ˜ì •
    Updating --> Ready: ìˆ˜ì • ì™„ë£Œ

    Ready --> Deleted: ì‚¬ìš©ì ì‚­ì œ
    Error --> Deleted: ê´€ë¦¬ì ì‚­ì œ
    Rejected --> [*]
    Deleted --> [*]

    note right of Processing
        status = "processing"
        ë¹„ë™ê¸° ì‘ì—… ì§„í–‰ ì¤‘
    end note

    note right of Ready
        status = "ready"
        ìŠ¤íŠ¸ë¦¬ë° ê°€ëŠ¥
    end note

    note right of Error
        status = "error"
        ì¬ì‹œë„ ë˜ëŠ” ì‚­ì œ í•„ìš”
    end note
```

### ì‚¬ìš©ì ì¸ì¦ ìƒíƒœ

```mermaid
stateDiagram-v2
    [*] --> Anonymous: í˜ì´ì§€ ì ‘ì†

    Anonymous --> Registering: íšŒì›ê°€ì… ì‹œì‘
    Registering --> Unverified: íšŒì›ê°€ì… ì™„ë£Œ

    Unverified --> VerificationSent: ì¸ì¦ ì½”ë“œ ìš”ì²­
    VerificationSent --> Verified: ì½”ë“œ ì…ë ¥ ì„±ê³µ
    VerificationSent --> Unverified: ì½”ë“œ ë§Œë£Œ/ì˜¤ë¥˜

    Verified --> Authenticated: ë¡œê·¸ì¸ ì„±ê³µ
    Anonymous --> Authenticated: ë¡œê·¸ì¸ ì„±ê³µ (ê¸°ì¡´ ìœ ì €)

    Authenticated --> TokenExpired: 30ë¶„ ê²½ê³¼
    TokenExpired --> Authenticated: Refresh Token ì‚¬ìš©
    TokenExpired --> Anonymous: Refresh Token ë§Œë£Œ

    Authenticated --> Anonymous: ë¡œê·¸ì•„ì›ƒ

    note right of Unverified
        is_verified = false
        ë¡œê·¸ì¸ ë¶ˆê°€
    end note

    note right of Verified
        is_verified = true
        ë¡œê·¸ì¸ ê°€ëŠ¥
    end note

    note right of Authenticated
        Access Token ë³´ìœ 
        API ì ‘ê·¼ ê°€ëŠ¥
    end note
```

---

## ì»´í¬ë„ŒíŠ¸ ê´€ê³„ë„

### Frontend ì»´í¬ë„ŒíŠ¸ ê³„ì¸µ

```mermaid
graph TB
    A[App.tsx] --> B[Router]

    B --> C[AuthContext Provider]

    C --> D[Public Routes]
    C --> E[Protected Routes]

    D --> F[Register Page]
    D --> G[Login Page]
    D --> H[Verify Email Page]
    D --> I[Videos List Page]
    D --> J[Video Detail Page]

    E --> K[Upload Page]
    E --> L[My Videos Page]

    I --> M[Layout]
    J --> M
    K --> M
    L --> M

    M --> N[Header]
    M --> O[Main Content]
    M --> P[Footer]

    I --> Q[VideoCard Component]
    Q --> R[Thumbnail Image]
    Q --> S[Progress Indicators]
    Q --> T[Video Info]

    J --> U[VideoPlayer Component]
    U --> V[Video.js]

    K --> W[Upload Form]
    W --> X[File Input]
    W --> Y[Progress Bar]

    F --> Z[API Client]
    G --> Z
    H --> Z
    K --> Z
    Q --> Z
    U --> Z

    C --> AA[localStorage]
    Z --> AB[Axios Instance]

    style A fill:#60a5fa
    style C fill:#34d399
    style M fill:#fbbf24
    style Z fill:#f87171
```

### Backend ì„œë¹„ìŠ¤ ê³„ì¸µ

```mermaid
graph TB
    subgraph "API Layer"
        A[Auth Router]
        B[Video Router]
    end

    subgraph "Service Layer"
        C[Auth Service]
        D[Video Service]
        E[Thumbnail Service]
        F[Email Service]
    end

    subgraph "Core Layer"
        G[Security Utils<br/>JWT, Password Hash]
        H[Database Session]
        I[Config Settings]
    end

    subgraph "Model Layer"
        J[User Model]
        K[Video Model]
        L[Thumbnail Model]
        M[EmailVerification Model]
    end

    subgraph "External"
        N[FFmpeg]
        O[FFprobe]
        P[SMTP]
    end

    A --> C
    B --> D

    C --> G
    C --> F
    C --> H

    D --> E
    D --> H

    E --> N
    E --> O

    F --> P

    H --> J
    H --> K
    H --> L
    H --> M

    C --> I
    D --> I
    E --> I
    F --> I

    style A fill:#60a5fa
    style B fill:#60a5fa
    style C fill:#34d399
    style D fill:#34d399
    style E fill:#34d399
    style F fill:#34d399
    style G fill:#fbbf24
    style H fill:#fbbf24
```

---

## ë°°í¬ ì•„í‚¤í…ì²˜

### í˜„ì¬ ê°œë°œ í™˜ê²½

```mermaid
graph TB
    subgraph "Developer Machine"
        subgraph "Frontend Container"
            A[Vite Dev Server<br/>:5174]
            B[React App<br/>Hot Reload]
        end

        subgraph "Backend Container"
            C[Uvicorn Server<br/>:8000]
            D[FastAPI App<br/>Auto Reload]
        end

        subgraph "Database"
            E[(PostgreSQL<br/>:5432)]
        end

        subgraph "File System"
            F[/tmp/videos/<br/>Video Files]
            G[/tmp/videos/thumbnails/<br/>Thumbnail Files]
        end

        subgraph "External Services"
            H[Gmail SMTP<br/>:587]
            I[FFmpeg/FFprobe<br/>Local Binary]
        end
    end

    A -->|API Requests| C
    C -->|Database Queries| E
    C -->|File Operations| F
    C -->|Thumbnail Operations| G
    C -->|Video Processing| I
    C -->|Send Email| H

    B -->|HTTP Stream| C

    style A fill:#60a5fa
    style C fill:#34d399
    style E fill:#fbbf24
    style F fill:#f87171
    style G fill:#f87171
```

### í”„ë¡œë•ì…˜ ì•„í‚¤í…ì²˜ (ê³„íš)

```mermaid
graph TB
    subgraph "CDN"
        A[CloudFront<br/>Static Assets]
    end

    subgraph "Load Balancer"
        B[Application Load Balancer]
    end

    subgraph "Application Tier"
        C[Frontend Server 1<br/>Nginx + React]
        D[Frontend Server 2<br/>Nginx + React]
        E[Backend Server 1<br/>FastAPI]
        F[Backend Server 2<br/>FastAPI]
    end

    subgraph "Worker Tier"
        G[Celery Worker 1<br/>Video Processing]
        H[Celery Worker 2<br/>Thumbnail Generation]
    end

    subgraph "Message Queue"
        I[Redis<br/>Task Queue]
    end

    subgraph "Database Tier"
        J[(PostgreSQL Primary)]
        K[(PostgreSQL Replica)]
    end

    subgraph "Storage Tier"
        L[S3<br/>Video Files]
        M[S3<br/>Thumbnails]
    end

    subgraph "Cache Layer"
        N[Redis<br/>Session Cache]
    end

    subgraph "Monitoring"
        O[CloudWatch]
        P[Sentry]
    end

    Users --> A
    Users --> B
    A --> C
    A --> D
    B --> C
    B --> D
    B --> E
    B --> F

    C --> E
    D --> F

    E --> J
    F --> J
    E --> N
    F --> N

    E --> I
    F --> I

    I --> G
    I --> H

    G --> L
    H --> M
    G --> J
    H --> J

    J --> K

    E --> O
    F --> O
    G --> P
    H --> P

    style A fill:#60a5fa
    style B fill:#34d399
    style J fill:#fbbf24
    style L fill:#f87171
    style M fill:#f87171
```

---

## ë„¤íŠ¸ì›Œí¬ í”Œë¡œìš°

### API ìš”ì²­ íë¦„ (ì¸ì¦ í¬í•¨)

```mermaid
sequenceDiagram
    participant Browser
    participant React
    participant AuthContext
    participant APIClient
    participant FastAPI
    participant Middleware
    participant Service
    participant Database

    Browser->>React: í˜ì´ì§€ ë¡œë“œ
    React->>AuthContext: í† í° í™•ì¸
    AuthContext->>Browser: localStorage ì¡°íšŒ

    alt í† í° ìˆìŒ
        AuthContext->>APIClient: ì¸ì¦ í—¤ë” ì„¤ì •
    else í† í° ì—†ìŒ
        Note over React: Public í˜ì´ì§€ë§Œ ì ‘ê·¼
    end

    React->>APIClient: API ìš”ì²­
    APIClient->>FastAPI: HTTP Request + Bearer Token

    FastAPI->>Middleware: ìš”ì²­ ê²€ì¦
    Middleware->>Middleware: JWT í† í° ê²€ì¦

    alt í† í° ìœ íš¨
        Middleware->>Service: ìš”ì²­ ì „ë‹¬
        Service->>Database: ë°ì´í„° ì¡°íšŒ
        Database-->>Service: ê²°ê³¼
        Service-->>FastAPI: ì‘ë‹µ ë°ì´í„°
    else í† í° ë¬´íš¨/ë§Œë£Œ
        Middleware-->>FastAPI: 401 Unauthorized
        FastAPI-->>APIClient: ì—ëŸ¬
        APIClient->>AuthContext: ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
        AuthContext->>React: ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
    end

    FastAPI-->>APIClient: 200 OK + Data
    APIClient-->>React: ì‘ë‹µ ë°ì´í„°
    React-->>Browser: UI ì—…ë°ì´íŠ¸
```

---

## ì—ëŸ¬ ì²˜ë¦¬ í”Œë¡œìš°

```mermaid
flowchart TD
    A[ìš”ì²­ ì‹œì‘] --> B{ìš”ì²­ ìœ í˜•}

    B -->|íŒŒì¼ ì—…ë¡œë“œ| C{íŒŒì¼ ê²€ì¦}
    B -->|API í˜¸ì¶œ| D{ì¸ì¦ ê²€ì¦}

    C -->|ì‹¤íŒ¨| E[400 Bad Request<br/>íŒŒì¼ í˜•ì‹/í¬ê¸° ì˜¤ë¥˜]
    C -->|ì„±ê³µ| F{ë””ìŠ¤í¬ ê³µê°„}

    F -->|ë¶€ì¡±| G[507 Insufficient Storage]
    F -->|ì¶©ë¶„| H{FFmpeg ì²˜ë¦¬}

    H -->|ì‹¤íŒ¨| I[500 Internal Error<br/>ë©”íƒ€ë°ì´í„° ì¶”ì¶œ ì‹¤íŒ¨]
    H -->|ì„±ê³µ| J[201 Created<br/>ì—…ë¡œë“œ ì„±ê³µ]

    D -->|ì‹¤íŒ¨| K[401 Unauthorized<br/>í† í° ì—†ìŒ/ë§Œë£Œ]
    D -->|ì„±ê³µ| L{ê¶Œí•œ ê²€ì¦}

    L -->|ì‹¤íŒ¨| M[403 Forbidden<br/>ê¶Œí•œ ì—†ìŒ]
    L -->|ì„±ê³µ| N{ë¦¬ì†ŒìŠ¤ ì¡´ì¬}

    N -->|ì—†ìŒ| O[404 Not Found]
    N -->|ì¡´ì¬| P[200 OK<br/>ìš”ì²­ ì„±ê³µ]

    E --> Q[í”„ë¡ íŠ¸ì—”ë“œ<br/>ì—ëŸ¬ í‘œì‹œ]
    G --> Q
    I --> Q
    K --> R[ë¡œê·¸ì¸ í˜ì´ì§€<br/>ë¦¬ë‹¤ì´ë ‰íŠ¸]
    M --> Q
    O --> Q

    J --> S[ì„±ê³µ ë©”ì‹œì§€<br/>í‘œì‹œ]
    P --> S

    style E fill:#f87171
    style G fill:#f87171
    style I fill:#f87171
    style K fill:#fbbf24
    style M fill:#fbbf24
    style O fill:#fbbf24
    style J fill:#34d399
    style P fill:#34d399
```

---

## ì„±ëŠ¥ ìµœì í™” ì „ëµ

### í”„ë¡ íŠ¸ì—”ë“œ ìµœì í™”

```mermaid
mindmap
    root((Frontend<br/>Optimization))
        Code Splitting
            Route-based
            Component-based
            Lazy Loading
        Asset Optimization
            Image Compression
            WebP Format
            CDN Delivery
        API Optimization
            Request Caching
            Debouncing
            Intersection Observer
        State Management
            Context API
            LocalStorage
            Minimal Re-renders
        Build Optimization
            Vite Bundling
            Tree Shaking
            Minification
```

### ë°±ì—”ë“œ ìµœì í™”

```mermaid
mindmap
    root((Backend<br/>Optimization))
        Database
            Indexing
            Query Optimization
            Connection Pooling
            Read Replicas
        Caching
            Redis Sessions
            Response Caching
            Static File Caching
        File Processing
            Async Processing
            Celery Workers
            Thumbnail Preload
        API Design
            Pagination
            Field Selection
            Batch Requests
        Server
            Async/Await
            Connection Limits
            Load Balancing
```

---

## ë³´ì•ˆ ê³„ì¸µ

```mermaid
graph TB
    subgraph "Client Security"
        A[HTTPS Only]
        B[XSS Prevention]
        C[CSRF Token]
        D[Input Validation]
    end

    subgraph "API Security"
        E[JWT Authentication]
        F[Rate Limiting]
        G[CORS Policy]
        H[Request Validation]
    end

    subgraph "Application Security"
        I[Password Hashing<br/>bcrypt]
        J[SQL Injection Prevention<br/>ORM]
        K[File Upload Validation]
        L[Path Traversal Prevention]
    end

    subgraph "Infrastructure Security"
        M[Firewall Rules]
        N[SSL/TLS]
        O[Environment Variables]
        P[Secrets Management]
    end

    A --> E
    B --> H
    C --> G
    D --> H

    E --> I
    F --> K
    G --> J
    H --> K

    I --> M
    J --> M
    K --> L
    L --> M

    M --> N
    N --> O
    O --> P

    style A fill:#60a5fa
    style E fill:#34d399
    style I fill:#fbbf24
    style M fill:#f87171
```

---

## ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹…

```mermaid
graph LR
    subgraph "Application"
        A[Frontend]
        B[Backend]
        C[Workers]
    end

    subgraph "Logging"
        D[Application Logs]
        E[Access Logs]
        F[Error Logs]
    end

    subgraph "Monitoring"
        G[Performance Metrics]
        H[Error Tracking]
        I[Usage Analytics]
    end

    subgraph "Alerting"
        J[Email Alerts]
        K[Slack Notifications]
        L[PagerDuty]
    end

    A --> D
    B --> D
    C --> D

    B --> E

    A --> F
    B --> F
    C --> F

    D --> G
    E --> G
    F --> H

    A --> I

    H --> J
    H --> K
    H --> L

    style D fill:#60a5fa
    style H fill:#f87171
    style G fill:#34d399
```

---

## ë°ì´í„° ë°±ì—… ë° ë³µêµ¬

```mermaid
flowchart TD
    A[Production Database] --> B[Daily Backup<br/>3 AM UTC]

    B --> C{Backup Type}

    C -->|Full| D[S3 Bucket<br/>Full Backups]
    C -->|Incremental| E[S3 Bucket<br/>Incremental]

    D --> F[Retention Policy<br/>30 Days]
    E --> G[Retention Policy<br/>7 Days]

    F --> H{Disaster?}
    G --> H

    H -->|Yes| I[Recovery Process]
    H -->|No| J[Regular Cleanup]

    I --> K[Restore from S3]
    K --> L[Verify Data Integrity]
    L --> M[Switch to Backup]

    J --> N[Delete Old Backups]

    style A fill:#60a5fa
    style I fill:#f87171
    style M fill:#34d399
```

---

ì´ ë¬¸ì„œëŠ” ì‹œìŠ¤í…œì˜ ì „ì²´ì ì¸ íë¦„ê³¼ ìƒí˜¸ì‘ìš©ì„ ì‹œê°í™”í•˜ì—¬ ì´í•´ë¥¼ ë•ìŠµë‹ˆë‹¤. ê° ë‹¤ì´ì–´ê·¸ë¨ì€ Mermaid í˜•ì‹ìœ¼ë¡œ ì‘ì„±ë˜ì–´ GitHub, Notion ë“± ëŒ€ë¶€ë¶„ì˜ ë§ˆí¬ë‹¤ìš´ ë Œë”ëŸ¬ì—ì„œ ìë™ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤.
